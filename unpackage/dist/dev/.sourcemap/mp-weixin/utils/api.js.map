{"version":3,"file":"api.js","sources":["utils/api.js"],"sourcesContent":["import config from './config.js'\n\n// 统一请求方法\nfunction request(options) {\n  return new Promise((resolve, reject) => {\n    // 显示加载提示\n    if (config.showLoading) {\n      uni.showLoading({\n        title: '加载中...',\n        mask: true\n      })\n    }\n    \n    // 获取 token（如果有）\n    const token = uni.getStorageSync('token') || ''\n    \n    // 发送请求\n    uni.request({\n      url: config.baseURL + options.url,\n      method: options.method || 'GET',\n      data: options.data || {},\n      header: {\n        'Content-Type': 'application/json',\n        'Authorization': token ? `Bearer ${token}` : '',\n        ...options.header\n      },\n      timeout: config.timeout,\n      success: (res) => {\n        // 隐藏加载提示\n        if (config.showLoading) {\n          uni.hideLoading()\n        }\n        \n        // 处理响应\n        if (res.statusCode === 200) {\n          const response = res.data\n          if (response.code === 200) {\n            resolve(response.data)\n          } else if (response.code === 401) {\n            // token 过期或未登录，清除用户信息并跳转到登录页\n            uni.removeStorageSync('userInfo')\n            uni.removeStorageSync('userId')\n            uni.removeStorageSync('token')\n            uni.showToast({\n              title: '登录已过期，请重新登录',\n              icon: 'none'\n            })\n            setTimeout(() => {\n              uni.reLaunch({\n                url: '/pages/user/login'\n              })\n            }, 1500)\n            reject(new Error('登录已过期'))\n          } else {\n            // 业务错误\n            if (config.showError) {\n              uni.showToast({\n                title: response.message || '请求失败',\n                icon: 'none'\n              })\n            }\n            reject(new Error(response.message || '请求失败'))\n          }\n        } else {\n          // HTTP 错误\n          if (config.showError) {\n            uni.showToast({\n              title: '网络错误',\n              icon: 'none'\n            })\n          }\n          reject(new Error('网络错误'))\n        }\n      },\n      fail: (err) => {\n        // 隐藏加载提示\n        if (config.showLoading) {\n          uni.hideLoading()\n        }\n        \n        // 网络错误\n        if (config.showError) {\n          uni.showToast({\n            title: '网络连接失败',\n            icon: 'none'\n          })\n        }\n        reject(err)\n      }\n    })\n  })\n}\n\n// GET 请求\nexport function get(url, params = {}) {\n  // 将参数拼接到 URL\n  let queryString = ''\n  if (Object.keys(params).length > 0) {\n    queryString = '?' + Object.keys(params)\n      .map(key => `${encodeURIComponent(key)}=${encodeURIComponent(params[key])}`)\n      .join('&')\n  }\n  \n  return request({\n    url: url + queryString,\n    method: 'GET'\n  })\n}\n\n// POST 请求\nexport function post(url, data = {}) {\n  return request({\n    url: url,\n    method: 'POST',\n    data: data\n  })\n}\n\n// PUT 请求\nexport function put(url, data = {}) {\n  return request({\n    url: url,\n    method: 'PUT',\n    data: data\n  })\n}\n\n// DELETE 请求\nexport function del(url) {\n  return request({\n    url: url,\n    method: 'DELETE'\n  })\n}\n\nexport default {\n  get,\n  post,\n  put,\n  delete: del\n}\n\n"],"names":["uni","config"],"mappings":"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"}