{"version":3,"file":"auth.js","sources":["utils/auth.js"],"sourcesContent":["// 用户认证相关工具函数\r\n\r\n/**\r\n * 检查是否已登录\r\n */\r\nexport function isLoggedIn() {\r\n  const token = uni.getStorageSync('token')\r\n  const userInfo = uni.getStorageSync('userInfo')\r\n  return !!(token && userInfo)\r\n}\r\n\r\n/**\r\n * 获取当前用户信息\r\n */\r\nexport function getCurrentUser() {\r\n  return uni.getStorageSync('userInfo') || null\r\n}\r\n\r\n/**\r\n * 获取当前用户ID\r\n */\r\nexport function getCurrentUserId() {\r\n  const userInfo = getCurrentUser()\r\n  return userInfo ? userInfo.id : null\r\n}\r\n\r\n/**\r\n * 获取 token\r\n */\r\nexport function getToken() {\r\n  return uni.getStorageSync('token') || ''\r\n}\r\n\r\n/**\r\n * 保存用户信息和 token\r\n */\r\nexport function saveUserInfo(userInfo, token) {\r\n  if (userInfo) {\r\n    uni.setStorageSync('userInfo', userInfo)\r\n    if (userInfo.id) {\r\n      uni.setStorageSync('userId', userInfo.id)\r\n    }\r\n  }\r\n  if (token) {\r\n    uni.setStorageSync('token', token)\r\n  }\r\n}\r\n\r\n/**\r\n * 清除用户信息（退出登录）\r\n */\r\nexport function clearUserInfo() {\r\n  uni.removeStorageSync('userInfo')\r\n  uni.removeStorageSync('userId')\r\n  uni.removeStorageSync('token')\r\n}\r\n\r\n/**\r\n * 检查登录状态，未登录则跳转到登录页\r\n */\r\nexport function checkLogin() {\r\n  if (!isLoggedIn()) {\r\n    uni.showToast({\r\n      title: '请先登录',\r\n      icon: 'none'\r\n    })\r\n    setTimeout(() => {\r\n      uni.navigateTo({\r\n        url: '/pages/user/login'\r\n      })\r\n    }, 1500)\r\n    return false\r\n  }\r\n  return true\r\n}\r\n\r\n/**\r\n * 退出登录\r\n */\r\nexport function logout() {\r\n  return new Promise((resolve) => {\r\n    uni.showModal({\r\n      title: '提示',\r\n      content: '确定要退出登录吗？',\r\n      success: (res) => {\r\n        if (res.confirm) {\r\n          // 清除用户信息\r\n          clearUserInfo()\r\n          \r\n          uni.showToast({\r\n            title: '已退出登录',\r\n            icon: 'success'\r\n          })\r\n          \r\n          // 跳转到登录页\r\n          setTimeout(() => {\r\n            uni.reLaunch({\r\n              url: '/pages/user/login'\r\n            })\r\n            resolve()\r\n          }, 1500)\r\n        } else {\r\n          resolve()\r\n        }\r\n      }\r\n    })\r\n  })\r\n}\r\n\r\nexport default {\r\n  isLoggedIn,\r\n  getCurrentUser,\r\n  getCurrentUserId,\r\n  getToken,\r\n  saveUserInfo,\r\n  clearUserInfo,\r\n  checkLogin,\r\n  logout\r\n}\r\n\r\n\r\n\r\n\r\n\r\n"],"names":["uni"],"mappings":";;AAKO,SAAS,aAAa;AAC3B,QAAM,QAAQA,cAAAA,MAAI,eAAe,OAAO;AACxC,QAAM,WAAWA,cAAAA,MAAI,eAAe,UAAU;AAC9C,SAAO,CAAC,EAAE,SAAS;AACrB;AAKO,SAAS,iBAAiB;AAC/B,SAAOA,oBAAI,eAAe,UAAU,KAAK;AAC3C;AAKO,SAAS,mBAAmB;AACjC,QAAM,WAAW,eAAgB;AACjC,SAAO,WAAW,SAAS,KAAK;AAClC;AAYO,SAAS,aAAa,UAAU,OAAO;AAC5C,MAAI,UAAU;AACZA,wBAAI,eAAe,YAAY,QAAQ;AACvC,QAAI,SAAS,IAAI;AACfA,oBAAAA,MAAI,eAAe,UAAU,SAAS,EAAE;AAAA,IACzC;AAAA,EACF;AACD,MAAI,OAAO;AACTA,wBAAI,eAAe,SAAS,KAAK;AAAA,EAClC;AACH;AAKO,SAAS,gBAAgB;AAC9BA,gBAAG,MAAC,kBAAkB,UAAU;AAChCA,gBAAG,MAAC,kBAAkB,QAAQ;AAC9BA,gBAAG,MAAC,kBAAkB,OAAO;AAC/B;AAKO,SAAS,aAAa;AAC3B,MAAI,CAAC,WAAU,GAAI;AACjBA,kBAAAA,MAAI,UAAU;AAAA,MACZ,OAAO;AAAA,MACP,MAAM;AAAA,IACZ,CAAK;AACD,eAAW,MAAM;AACfA,oBAAAA,MAAI,WAAW;AAAA,QACb,KAAK;AAAA,MACb,CAAO;AAAA,IACF,GAAE,IAAI;AACP,WAAO;AAAA,EACR;AACD,SAAO;AACT;AAKO,SAAS,SAAS;AACvB,SAAO,IAAI,QAAQ,CAAC,YAAY;AAC9BA,kBAAAA,MAAI,UAAU;AAAA,MACZ,OAAO;AAAA,MACP,SAAS;AAAA,MACT,SAAS,CAAC,QAAQ;AAChB,YAAI,IAAI,SAAS;AAEf,wBAAe;AAEfA,wBAAAA,MAAI,UAAU;AAAA,YACZ,OAAO;AAAA,YACP,MAAM;AAAA,UAClB,CAAW;AAGD,qBAAW,MAAM;AACfA,0BAAAA,MAAI,SAAS;AAAA,cACX,KAAK;AAAA,YACnB,CAAa;AACD,oBAAS;AAAA,UACV,GAAE,IAAI;AAAA,QACjB,OAAe;AACL,kBAAS;AAAA,QACV;AAAA,MACF;AAAA,IACP,CAAK;AAAA,EACL,CAAG;AACH;;;;;;;"}