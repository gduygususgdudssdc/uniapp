{"version":3,"file":"edit.js","sources":["pages/address/edit.vue","../../hbuildx/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvYWRkcmVzcy9lZGl0LnZ1ZQ"],"sourcesContent":["<template>\n\t<view class=\"container\">\n\t\t<view class=\"form\">\n\t\t\t<view class=\"form-item\">\n\t\t\t\t<text class=\"label\">收货人</text>\n\t\t\t\t<input class=\"input\" v-model=\"form.name\" placeholder=\"请输入收货人姓名\" />\n\t\t\t</view>\n\t\t\t\n\t\t\t<view class=\"form-item\">\n\t\t\t\t<text class=\"label\">手机号</text>\n\t\t\t\t<input class=\"input\" type=\"number\" v-model=\"form.phone\" placeholder=\"请输入手机号\" maxlength=\"11\" />\n\t\t\t</view>\n\t\t\t\n\t\t\t<view class=\"form-item\">\n\t\t\t\t<text class=\"label\">所在地区</text>\n\t\t\t\t<picker mode=\"region\" :value=\"regionValue\" @change=\"onRegionChange\">\n\t\t\t\t\t<view class=\"picker\">\n\t\t\t\t\t\t<text :class=\"{ placeholder: !form.province }\">\n\t\t\t\t\t\t\t{{ form.province && form.city && form.district ?\n\t\t\t\t\t\t\t\t`${form.province} ${form.city} ${form.district}` : '请选择所在地区' }}\n\t\t\t\t\t\t</text>\n\t\t\t\t\t\t<text class=\"picker-arrow\">›</text>\n\t\t\t\t\t</view>\n\t\t\t\t</picker>\n\t\t\t</view>\n\t\t\t\n\t\t\t<view class=\"form-item\">\n\t\t\t\t<text class=\"label\">详细地址</text>\n\t\t\t\t<textarea class=\"textarea\" v-model=\"form.detail\" placeholder=\"请输入详细地址\" maxlength=\"100\"></textarea>\n\t\t\t</view>\n\t\t\t\n\t\t\t<view class=\"form-item\">\n\t\t\t\t<label class=\"checkbox-label\">\n\t\t\t\t\t<checkbox :checked=\"form.isDefault\" @change=\"onDefaultChange\" />\n\t\t\t\t\t<text>设为默认地址</text>\n\t\t\t\t</label>\n\t\t\t</view>\n\t\t\t\n\t\t\t<button class=\"submit-btn\" @click=\"handleSubmit\">保存</button>\n\t\t</view>\n\t</view>\n</template>\n\n<script setup>\nimport { ref, computed } from 'vue'\nimport { onLoad } from '@dcloudio/uni-app'\nimport { addressApi } from '@/utils/apiService.js'\nimport { getCurrentUser, getCurrentUserId, checkLogin, isLoggedIn } from '@/utils/auth.js'\n\nconst addressId = ref('')\nconst form = ref({\n\tname: '',\n\tphone: '',\n\tprovince: '',\n\tcity: '',\n\tdistrict: '',\n\tdetail: '',\n\tisDefault: false\n});\n\n// 为 Picker 组件提供正确的 value 格式\nconst regionValue = computed(() => {\n\tif (form.value.province && form.value.city && form.value.district) {\n\t\treturn [form.value.province, form.value.city, form.value.district]\n\t}\n\treturn []\n})\n\n// 获取地址详情\nconst loadAddress = async () => {\n\tconsole.log('loadAddress 被调用')\n\tconsole.log('addressId:', addressId.value)\n\t\n\t// 检查登录状态\n\tif (!isLoggedIn()) {\n\t\tconsole.log('用户未登录')\n\t\tuni.showToast({ title: '请先登录', icon: 'none' })\n\t\tsetTimeout(() => {\n\t\t\tuni.navigateTo({ url: '/pages/user/login' })\n\t\t}, 1500)\n\t\treturn\n\t}\n\n\t// 检查地址ID\n\tif (!addressId.value) {\n\t\tconsole.log('addressId 为空，跳过加载')\n\t\treturn\n\t}\n\n\ttry {\n\t\tconsole.log('开始请求地址信息，ID:', addressId.value)\n\t\tconst address = await addressApi.getAddress(addressId.value)\n\t\tconsole.log('获取到地址信息:', address)\n\t\t\n\t\tif (address) {\n\t\t\tform.value = { ...address }\n\t\t\tconsole.log('地址信息已加载到表单:', form.value)\n\t\t} else {\n\t\t\tconsole.log('地址不存在')\n\t\t\tuni.showToast({ title: '地址不存在', icon: 'none' })\n\t\t}\n\t} catch (error) {\n\t\tconsole.error('获取地址失败:', error)\n\t\tuni.showToast({ title: '获取地址失败: ' + (error.message || '未知错误'), icon: 'none', duration: 3000 })\n\t}\n}\n\nonLoad((options) => {\n\tconsole.log('页面加载，参数:', options)\n\tif (options && options.id) {\n\t\taddressId.value = options.id\n\t\tconsole.log('设置 addressId:', addressId.value)\n\t\tloadAddress()\n\t} else {\n\t\tconsole.log('没有地址ID，这是新增地址模式')\n\t}\n})\nconst onRegionChange = (e) => {\n\tconst [province, city, district] = e.detail.value\n\tform.value.province = province\n\tform.value.city = city\n\tform.value.district = district\n}\nconst onDefaultChange = (e) => {\n\tform.value.isDefault = e.detail.value.length > 0\n}\nconst handleSubmit = () => {\n\t\t\tif (!form.value.name) {\n\t\t\t\tuni.showToast({ title: '请输入收货人姓名', icon: 'none' })\n\t\t\t\treturn\n\t\t\t}\n\t\t\tif (!form.value.phone) {\n\t\t\t\tuni.showToast({ title: '请输入手机号', icon: 'none' })\n\t\t\t\treturn\n\t\t\t}\n\t\t\tif (!form.value.province) {\n\t\t\t\tuni.showToast({ title: '请选择所在地区', icon: 'none' })\n\t\t\t\treturn\n\t\t\t}\n\t\t\tif (!form.value.detail) {\n\t\t\t\tuni.showToast({ title: '请输入详细地址', icon: 'none' })\n\t\t\t\treturn\n\t\t\t}\n\t\t\t\n\t\t\tuni.showToast({\n\t\t\t\ttitle: '保存成功',\n\t\t\t\ticon: 'success'\n\t\t\t})\n\t\t\tsetTimeout(() => {\n\t\t\t\tuni.navigateBack()\n\t\t\t}, 1500)\n\t\t}\n</script>\n\n<style scoped>\n.container {\n\tmin-height: 100vh;\n\tbackground-color: #F5F5F5;\n\tpadding: 20rpx;\n}\n\n.form {\n\tbackground-color: #fff;\n\tborder-radius: 10rpx;\n\tpadding: 30rpx;\n}\n\n.form-item {\n\tmargin-bottom: 40rpx;\n}\n\n.label {\n\tfont-size: 28rpx;\n\tcolor: #333;\n\tfont-weight: bold;\n\tmargin-bottom: 20rpx;\n\tdisplay: block;\n}\n\n.input {\n\twidth: 100%;\n\theight: 80rpx;\n\tbackground-color: #F5F5F5;\n\tborder-radius: 10rpx;\n\tpadding: 0 20rpx;\n\tfont-size: 28rpx;\n}\n\n.picker {\n\tdisplay: flex;\n\tjustify-content: space-between;\n\talign-items: center;\n\theight: 80rpx;\n\tbackground-color: #F5F5F5;\n\tborder-radius: 10rpx;\n\tpadding: 0 20rpx;\n}\n\n.picker text.placeholder {\n\tcolor: #999;\n}\n\n.picker-arrow {\n\tfont-size: 20rpx;\n\tcolor: #999;\n\tfont-weight: bold;\n}\n\n.textarea {\n\twidth: 100%;\n\tmin-height: 150rpx;\n\tbackground-color: #F5F5F5;\n\tborder-radius: 10rpx;\n\tpadding: 20rpx;\n\tfont-size: 28rpx;\n}\n\n.checkbox-label {\n\tdisplay: flex;\n\talign-items: center;\n\tfont-size: 28rpx;\n\tcolor: #333;\n}\n\n.submit-btn {\n\twidth: 100%;\n\theight: 88rpx;\n\tbackground-color: #007AFF;\n\tcolor: #fff;\n\tborder-radius: 50rpx;\n\tfont-size: 32rpx;\n\tmargin-top: 40rpx;\n\tborder: none;\n}\n</style>\n\n\n\n\n\n","import MiniProgramPage from 'G:/小程序xycy页面/SkyMark/pages/address/edit.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","computed","uni","isLoggedIn","addressApi","onLoad"],"mappings":";;;;;;;AAiDA,UAAM,YAAYA,cAAG,IAAC,EAAE;AACxB,UAAM,OAAOA,cAAAA,IAAI;AAAA,MAChB,MAAM;AAAA,MACN,OAAO;AAAA,MACP,UAAU;AAAA,MACV,MAAM;AAAA,MACN,UAAU;AAAA,MACV,QAAQ;AAAA,MACR,WAAW;AAAA,IACZ,CAAC;AAGD,UAAM,cAAcC,cAAQ,SAAC,MAAM;AAClC,UAAI,KAAK,MAAM,YAAY,KAAK,MAAM,QAAQ,KAAK,MAAM,UAAU;AAClE,eAAO,CAAC,KAAK,MAAM,UAAU,KAAK,MAAM,MAAM,KAAK,MAAM,QAAQ;AAAA,MACjE;AACD,aAAO,CAAE;AAAA,IACV,CAAC;AAGD,UAAM,cAAc,YAAY;AAC/BC,oBAAAA,mDAAY,iBAAiB;AAC7BA,oBAAY,MAAA,MAAA,OAAA,gCAAA,cAAc,UAAU,KAAK;AAGzC,UAAI,CAACC,WAAU,WAAA,GAAI;AAClBD,sBAAAA,mDAAY,OAAO;AACnBA,sBAAG,MAAC,UAAU,EAAE,OAAO,QAAQ,MAAM,QAAQ;AAC7C,mBAAW,MAAM;AAChBA,wBAAAA,MAAI,WAAW,EAAE,KAAK,oBAAmB,CAAE;AAAA,QAC3C,GAAE,IAAI;AACP;AAAA,MACA;AAGD,UAAI,CAAC,UAAU,OAAO;AACrBA,sBAAAA,mDAAY,mBAAmB;AAC/B;AAAA,MACA;AAED,UAAI;AACHA,sBAAA,MAAA,MAAA,OAAA,gCAAY,gBAAgB,UAAU,KAAK;AAC3C,cAAM,UAAU,MAAME,iBAAAA,WAAW,WAAW,UAAU,KAAK;AAC3DF,sBAAAA,mDAAY,YAAY,OAAO;AAE/B,YAAI,SAAS;AACZ,eAAK,QAAQ,EAAE,GAAG,QAAS;AAC3BA,wBAAY,MAAA,MAAA,OAAA,gCAAA,eAAe,KAAK,KAAK;AAAA,QACxC,OAAS;AACNA,wBAAAA,MAAA,MAAA,OAAA,gCAAY,OAAO;AACnBA,wBAAG,MAAC,UAAU,EAAE,OAAO,SAAS,MAAM,QAAQ;AAAA,QAC9C;AAAA,MACD,SAAQ,OAAO;AACfA,sBAAAA,MAAc,MAAA,SAAA,iCAAA,WAAW,KAAK;AAC9BA,sBAAAA,MAAI,UAAU,EAAE,OAAO,cAAc,MAAM,WAAW,SAAS,MAAM,QAAQ,UAAU,IAAI,CAAE;AAAA,MAC7F;AAAA,IACF;AAEAG,kBAAM,OAAC,CAAC,YAAY;AACnBH,oBAAAA,MAAA,MAAA,OAAA,iCAAY,YAAY,OAAO;AAC/B,UAAI,WAAW,QAAQ,IAAI;AAC1B,kBAAU,QAAQ,QAAQ;AAC1BA,sBAAA,MAAA,MAAA,OAAA,iCAAY,iBAAiB,UAAU,KAAK;AAC5C,oBAAa;AAAA,MACf,OAAQ;AACNA,sBAAAA,MAAY,MAAA,OAAA,iCAAA,iBAAiB;AAAA,MAC7B;AAAA,IACF,CAAC;AACD,UAAM,iBAAiB,CAAC,MAAM;AAC7B,YAAM,CAAC,UAAU,MAAM,QAAQ,IAAI,EAAE,OAAO;AAC5C,WAAK,MAAM,WAAW;AACtB,WAAK,MAAM,OAAO;AAClB,WAAK,MAAM,WAAW;AAAA,IACvB;AACA,UAAM,kBAAkB,CAAC,MAAM;AAC9B,WAAK,MAAM,YAAY,EAAE,OAAO,MAAM,SAAS;AAAA,IAChD;AACA,UAAM,eAAe,MAAM;AACxB,UAAI,CAAC,KAAK,MAAM,MAAM;AACrBA,sBAAG,MAAC,UAAU,EAAE,OAAO,YAAY,MAAM,QAAQ;AACjD;AAAA,MACA;AACD,UAAI,CAAC,KAAK,MAAM,OAAO;AACtBA,sBAAG,MAAC,UAAU,EAAE,OAAO,UAAU,MAAM,QAAQ;AAC/C;AAAA,MACA;AACD,UAAI,CAAC,KAAK,MAAM,UAAU;AACzBA,sBAAG,MAAC,UAAU,EAAE,OAAO,WAAW,MAAM,QAAQ;AAChD;AAAA,MACA;AACD,UAAI,CAAC,KAAK,MAAM,QAAQ;AACvBA,sBAAG,MAAC,UAAU,EAAE,OAAO,WAAW,MAAM,QAAQ;AAChD;AAAA,MACA;AAEDA,oBAAAA,MAAI,UAAU;AAAA,QACb,OAAO;AAAA,QACP,MAAM;AAAA,MACV,CAAI;AACD,iBAAW,MAAM;AAChBA,sBAAAA,MAAI,aAAc;AAAA,MAClB,GAAE,IAAI;AAAA,IACP;;;;;;;;;;;;;;;;;;;;;ACtJH,GAAG,WAAW,eAAe;"}