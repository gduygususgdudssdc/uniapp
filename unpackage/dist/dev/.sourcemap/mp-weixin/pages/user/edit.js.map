{"version":3,"file":"edit.js","sources":["pages/user/edit.vue","../../hbuildx/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvdXNlci9lZGl0LnZ1ZQ"],"sourcesContent":["<template>\r\n\t<view class=\"container\">\r\n\t\t<view class=\"form\">\r\n\t\t\t<view class=\"form-item\">\r\n\t\t\t\t<text class=\"label\">收货人</text>\r\n\t\t\t\t<input class=\"input\" v-model=\"form.name\" placeholder=\"请输入收货人姓名\" />\r\n\t\t\t</view>\r\n\t\t\t\r\n\t\t\t<view class=\"form-item\">\r\n\t\t\t\t<text class=\"label\">手机号</text>\r\n\t\t\t\t<input class=\"input\" type=\"number\" v-model=\"form.phone\" placeholder=\"请输入手机号\" maxlength=\"11\" />\r\n\t\t\t</view>\r\n\t\t\t\r\n\t\t\t<view class=\"form-item\">\r\n\t\t\t\t<text class=\"label\">所在地区</text>\r\n\t\t\t\t<picker mode=\"region\" @change=\"onRegionChange\">\r\n\t\t\t\t\t<view class=\"picker\">\r\n\t\t\t\t\t\t<text :class=\"{ placeholder: !form.province }\">\r\n\t\t\t\t\t\t\t{{ form.province && form.city && form.district ? \r\n\t\t\t\t\t\t\t\t`${form.province} ${form.city} ${form.district}` : '请选择所在地区' }}\r\n\t\t\t\t\t\t</text>\r\n\t\t\t\t\t\t<uni-icons type=\"arrowright\" size=\"16\" color=\"#999\"></uni-icons>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</picker>\r\n\t\t\t</view>\r\n\t\t\t\r\n\t\t\t<view class=\"form-item\">\r\n\t\t\t\t<text class=\"label\">详细地址</text>\r\n\t\t\t\t<textarea class=\"textarea\" v-model=\"form.detail\" placeholder=\"请输入详细地址\" maxlength=\"100\"></textarea>\r\n\t\t\t</view>\r\n\t\t\t\r\n\t\t\t<view class=\"form-item\">\r\n\t\t\t\t<label class=\"checkbox-label\">\r\n\t\t\t\t\t<checkbox :checked=\"form.isDefault\" @change=\"onDefaultChange\" />\r\n\t\t\t\t\t<text>设为默认地址</text>\r\n\t\t\t\t</label>\r\n\t\t\t</view>\r\n\t\t\t\r\n\t\t\t<button class=\"submit-btn\" @click=\"handleSubmit\">保存</button>\r\n\t\t</view>\r\n\t</view>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref } from 'vue'\r\nimport { onLoad } from '@dcloudio/uni-app'\r\nimport { addressApi } from '@/utils/apiService.js'\r\nimport { getCurrentUser, getCurrentUserId, checkLogin, isLoggedIn } from '@/utils/auth.js'\r\n\r\nconst addressId = ref('')\r\nconst form = ref({\r\n\tname: '',\r\n\tphone: '',\r\n\tprovince: '',\r\n\tcity: '',\r\n\tdistrict: '',\r\n\tdetail: '',\r\n\tisDefault: false\r\n});\r\n\r\n// 修复：onLoad 括号闭合\r\nonLoad((options) => {\r\n\tif (options.id) {\r\n\t\taddressId.value = options.id\r\n\t\tloadAddress() // 加载已有地址数据\r\n\t}\r\n})\r\n\r\n// 修复：添加 async 关键字（因使用 await）\r\nconst loadAddress = async () => {\r\n\ttry {\r\n\t\tconst address = await addressApi.getAddress(addressId.value)\r\n\t\tif (address) {\r\n\t\t\t// 适配接口返回字段，确保地区字段正确赋值\r\n\t\t\tform.value = {\r\n\t\t\t\tname: address.name || '',\r\n\t\t\t\tphone: address.phone || '',\r\n\t\t\t\tprovince: address.province || '',\r\n\t\t\t\tcity: address.city || '',\r\n\t\t\t\tdistrict: address.district || '',\r\n\t\t\t\tdetail: address.detail || '',\r\n\t\t\t\tisDefault: address.isDefault || false\r\n\t\t\t}\r\n\t\t}\r\n\t} catch (error) {\r\n\t\tconsole.error('获取地址失败:', error)\r\n\t\tuni.showToast({ title: '加载地址失败', icon: 'none' })\r\n\t}\r\n}\r\n\r\nconst onRegionChange = (e) => {\r\n\tconst [province, city, district] = e.detail.value\r\n\tform.value.province = province\r\n\tform.value.city = city\r\n\tform.value.district = district\r\n}\r\n\r\n// 修复：checkbox 选中状态判断（微信小程序中 e.detail.value 为数组，H5 为布尔值）\r\nconst onDefaultChange = (e) => {\r\n\tform.value.isDefault = Array.isArray(e.detail.value) ? e.detail.value.length > 0 : e.detail.value\r\n}\r\n\r\nconst handleSubmit = async () => {\r\n\t// 1. 表单校验优化\r\n\tif (!form.value.name.trim()) {\r\n\t\tuni.showToast({ title: '请输入收货人姓名', icon: 'none' })\r\n\t\treturn\r\n\t}\r\n\t// 手机号格式校验\r\n\tconst phoneReg = /^1[3-9]\\d{9}$/\r\n\tif (!form.value.phone.trim() || !phoneReg.test(form.value.phone)) {\r\n\t\tuni.showToast({ title: '请输入正确的手机号', icon: 'none' })\r\n\t\treturn\r\n\t}\r\n\tif (!form.value.province || !form.value.city || !form.value.district) {\r\n\t\tuni.showToast({ title: '请选择所在地区', icon: 'none' })\r\n\t\treturn\r\n\t}\r\n\tif (!form.value.detail.trim()) {\r\n\t\tuni.showToast({ title: '请输入详细地址', icon: 'none' })\r\n\t\treturn\r\n\t}\r\n\r\n\t// 2. 构造提交数据（包含 addressId 用于修改）\r\n\tconst submitData = {\r\n\t\tid: addressId.value, // 关键：传递地址ID，告知接口是修改操作\r\n\t\t...form.value\r\n\t}\r\n\r\n\ttry {\r\n\t\t// 3. 调用修改地址接口（根据实际接口调整方法名）\r\n\t\tawait addressApi.updateAddress(submitData)\r\n\t\tuni.showToast({ title: '修改成功', icon: 'success' })\r\n\t\tsetTimeout(() => {\r\n\t\t\tuni.navigateBack() // 返回上一页并刷新列表\r\n\t\t}, 1500)\r\n\t} catch (error) {\r\n\t\tconsole.error('修改地址失败:', error)\r\n\t\tuni.showToast({ title: '修改失败，请重试', icon: 'none' })\r\n\t}\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.container {\r\n\tmin-height: 100vh;\r\n\tbackground-color: #F5F5F5;\r\n\tpadding: 20rpx;\r\n}\r\n\r\n.form {\r\n\tbackground-color: #fff;\r\n\tborder-radius: 10rpx;\r\n\tpadding: 30rpx;\r\n}\r\n\r\n.form-item {\r\n\tmargin-bottom: 40rpx;\r\n}\r\n\r\n.label {\r\n\tfont-size: 28rpx;\r\n\tcolor: #333;\r\n\tfont-weight: bold;\r\n\tmargin-bottom: 20rpx;\r\n\tdisplay: block;\r\n}\r\n\r\n.input {\r\n\twidth: 100%;\r\n\theight: 80rpx;\r\n\tbackground-color: #F5F5F5;\r\n\tborder-radius: 10rpx;\r\n\tpadding: 0 20rpx;\r\n\tfont-size: 28rpx;\r\n}\r\n\r\n.picker {\r\n\tdisplay: flex;\r\n\tjustify-content: space-between;\r\n\talign-items: center;\r\n\theight: 80rpx;\r\n\tbackground-color: #F5F5F5;\r\n\tborder-radius: 10rpx;\r\n\tpadding: 0 20rpx;\r\n}\r\n\r\n.picker text.placeholder {\r\n\tcolor: #999;\r\n}\r\n\r\n.textarea {\r\n\twidth: 100%;\r\n\tmin-height: 150rpx;\r\n\tbackground-color: #F5F5F5;\r\n\tborder-radius: 10rpx;\r\n\tpadding: 20rpx;\r\n\tfont-size: 28rpx;\r\n}\r\n\r\n.checkbox-label {\r\n\tdisplay: flex;\r\n\talign-items: center;\r\n\tfont-size: 28rpx;\r\n\tcolor: #333;\r\n}\r\n\r\n.submit-btn {\r\n\twidth: 100%;\r\n\theight: 88rpx;\r\n\tbackground-color: #007AFF;\r\n\tcolor: #fff;\r\n\tborder-radius: 50rpx;\r\n\tfont-size: 32rpx;\r\n\tmargin-top: 40rpx;\r\n\tborder: none;\r\n}\r\n</style>q","import MiniProgramPage from 'G:/小程序xycy页面/SkyMark/pages/user/edit.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","onLoad","addressApi","uni"],"mappings":";;;;;;;;;;AAiDA,UAAM,YAAYA,cAAG,IAAC,EAAE;AACxB,UAAM,OAAOA,cAAAA,IAAI;AAAA,MAChB,MAAM;AAAA,MACN,OAAO;AAAA,MACP,UAAU;AAAA,MACV,MAAM;AAAA,MACN,UAAU;AAAA,MACV,QAAQ;AAAA,MACR,WAAW;AAAA,IACZ,CAAC;AAGDC,kBAAM,OAAC,CAAC,YAAY;AACnB,UAAI,QAAQ,IAAI;AACf,kBAAU,QAAQ,QAAQ;AAC1B,oBAAa;AAAA,MACb;AAAA,IACF,CAAC;AAGD,UAAM,cAAc,YAAY;AAC/B,UAAI;AACH,cAAM,UAAU,MAAMC,iBAAAA,WAAW,WAAW,UAAU,KAAK;AAC3D,YAAI,SAAS;AAEZ,eAAK,QAAQ;AAAA,YACZ,MAAM,QAAQ,QAAQ;AAAA,YACtB,OAAO,QAAQ,SAAS;AAAA,YACxB,UAAU,QAAQ,YAAY;AAAA,YAC9B,MAAM,QAAQ,QAAQ;AAAA,YACtB,UAAU,QAAQ,YAAY;AAAA,YAC9B,QAAQ,QAAQ,UAAU;AAAA,YAC1B,WAAW,QAAQ,aAAa;AAAA,UAChC;AAAA,QACD;AAAA,MACD,SAAQ,OAAO;AACfC,sBAAAA,MAAc,MAAA,SAAA,6BAAA,WAAW,KAAK;AAC9BA,sBAAG,MAAC,UAAU,EAAE,OAAO,UAAU,MAAM,QAAQ;AAAA,MAC/C;AAAA,IACF;AAEA,UAAM,iBAAiB,CAAC,MAAM;AAC7B,YAAM,CAAC,UAAU,MAAM,QAAQ,IAAI,EAAE,OAAO;AAC5C,WAAK,MAAM,WAAW;AACtB,WAAK,MAAM,OAAO;AAClB,WAAK,MAAM,WAAW;AAAA,IACvB;AAGA,UAAM,kBAAkB,CAAC,MAAM;AAC9B,WAAK,MAAM,YAAY,MAAM,QAAQ,EAAE,OAAO,KAAK,IAAI,EAAE,OAAO,MAAM,SAAS,IAAI,EAAE,OAAO;AAAA,IAC7F;AAEA,UAAM,eAAe,YAAY;AAEhC,UAAI,CAAC,KAAK,MAAM,KAAK,KAAI,GAAI;AAC5BA,sBAAG,MAAC,UAAU,EAAE,OAAO,YAAY,MAAM,QAAQ;AACjD;AAAA,MACA;AAED,YAAM,WAAW;AACjB,UAAI,CAAC,KAAK,MAAM,MAAM,KAAM,KAAI,CAAC,SAAS,KAAK,KAAK,MAAM,KAAK,GAAG;AACjEA,sBAAG,MAAC,UAAU,EAAE,OAAO,aAAa,MAAM,QAAQ;AAClD;AAAA,MACA;AACD,UAAI,CAAC,KAAK,MAAM,YAAY,CAAC,KAAK,MAAM,QAAQ,CAAC,KAAK,MAAM,UAAU;AACrEA,sBAAG,MAAC,UAAU,EAAE,OAAO,WAAW,MAAM,QAAQ;AAChD;AAAA,MACA;AACD,UAAI,CAAC,KAAK,MAAM,OAAO,KAAI,GAAI;AAC9BA,sBAAG,MAAC,UAAU,EAAE,OAAO,WAAW,MAAM,QAAQ;AAChD;AAAA,MACA;AAGD,YAAM,aAAa;AAAA,QAClB,IAAI,UAAU;AAAA;AAAA,QACd,GAAG,KAAK;AAAA,MACR;AAED,UAAI;AAEH,cAAMD,iBAAU,WAAC,cAAc,UAAU;AACzCC,sBAAG,MAAC,UAAU,EAAE,OAAO,QAAQ,MAAM,WAAW;AAChD,mBAAW,MAAM;AAChBA,wBAAAA,MAAI,aAAc;AAAA,QAClB,GAAE,IAAI;AAAA,MACP,SAAQ,OAAO;AACfA,sBAAAA,MAAc,MAAA,SAAA,8BAAA,WAAW,KAAK;AAC9BA,sBAAG,MAAC,UAAU,EAAE,OAAO,YAAY,MAAM,QAAQ;AAAA,MACjD;AAAA,IACF;;;;;;;;;;;;;;;;;;;;;;;;;AC3IA,GAAG,WAAW,eAAe;"}