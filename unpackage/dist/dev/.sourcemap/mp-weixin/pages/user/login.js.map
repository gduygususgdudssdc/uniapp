{"version":3,"file":"login.js","sources":["pages/user/login.vue","../../hbuildx/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvdXNlci9sb2dpbi52dWU"],"sourcesContent":["<template>\n\t<view class=\"container\">\n\t\t<view class=\"logo-section\">\n\t\t\t<image class=\"logo\" src=\"/static/logo.png\" mode=\"aspectFit\"></image>\n\t\t\t<text class=\"app-name\">‰∫åÊâã‰∫§ÊòìÂπ≥Âè∞</text>\n\t\t</view>\n\t\t\n\t\t<view class=\"form-section\">\n\t\t\t<view class=\"input-group\">\n\t\t\t\t<text class=\"input-icon\">üì±</text>\n\t\t\t\t<input class=\"input\" type=\"number\" v-model=\"form.phone\" placeholder=\"ËØ∑ËæìÂÖ•ÊâãÊú∫Âè∑\" maxlength=\"11\" />\n\t\t\t</view>\n\n\t\t\t<view class=\"input-group\">\n\t\t\t\t<text class=\"input-icon\">üîí</text>\n\t\t\t\t<input class=\"input\" type=\"password\" v-model=\"form.password\" placeholder=\"ËØ∑ËæìÂÖ•ÂØÜÁ†Å\" />\n\t\t\t</view>\n\t\t\t\n\t\t\t<button class=\"login-btn\" @click=\"handleLogin\" :disabled=\"loading\">\n\t\t\t\t{{ loading ? 'ÁôªÂΩï‰∏≠...' : 'ÁôªÂΩï' }}\n\t\t\t</button>\n\t\t\t\n\t\t\t<!-- ÂæÆ‰ø°Âø´Êç∑ÁôªÂΩï -->\n\t\t\t<!-- #ifdef MP-WEIXIN -->\n\t\t\t<view class=\"divider\">\n\t\t\t\t<view class=\"divider-line\"></view>\n\t\t\t\t<text class=\"divider-text\">Êàñ</text>\n\t\t\t\t<view class=\"divider-line\"></view>\n\t\t\t</view>\n\t\t\t\n\t\t\t<button class=\"wechat-login-btn\" @click=\"handleWechatLogin\" :disabled=\"wechatLoading\">\n\t\t\t\t<text class=\"wechat-icon\">üí¨</text>\n\t\t\t\t<text>{{ wechatLoading ? 'ÁôªÂΩï‰∏≠...' : 'ÂæÆ‰ø°Âø´Êç∑ÁôªÂΩï' }}</text>\n\t\t\t</button>\n\t\t\t<!-- #endif -->\n\t\t\t\n\t\t\t<view class=\"footer-links\">\n\t\t\t\t<text class=\"link\" @click=\"goToRegister\">Á´ãÂç≥Ê≥®ÂÜå</text>\n\t\t\t\t<text class=\"link\" @click=\"handleForgetPassword\">ÂøòËÆ∞ÂØÜÁ†ÅÔºü</text>\n\t\t\t</view>\n\t\t</view>\n\t</view>\n</template>\n\n<script setup>\nimport { ref } from 'vue'\nimport { onLoad } from '@dcloudio/uni-app'\nimport { userApi } from '@/utils/apiService.js'\nimport { saveUserInfo, isLoggedIn } from '@/utils/auth.js'\n\nconst form = ref({\n\tphone: '',\n\tpassword: ''\n})\n\nconst loading = ref(false)\nconst wechatLoading = ref(false)\n\n// Ê£ÄÊü•ÊòØÂê¶Â∑≤ÁôªÂΩï\nonLoad(() => {\n\tif (isLoggedIn()) {\n\t\tuni.showToast({ title: 'ÊÇ®Â∑≤ÁôªÂΩï', icon: 'none' })\n\t\tsetTimeout(() => {\n\t\t\tuni.navigateBack()\n\t\t}, 1500)\n\t}\n})\n\nasync function handleLogin() {\n\t// Ë°®ÂçïÈ™åËØÅ\n\tif (!form.value.phone) {\n\t\tuni.showToast({ title: 'ËØ∑ËæìÂÖ•ÊâãÊú∫Âè∑', icon: 'none' })\n\t\treturn\n\t}\n\t\n\t// ÊâãÊú∫Âè∑Ê†ºÂºèÈ™åËØÅ\n\tif (!/^1[3-9]\\d{9}$/.test(form.value.phone)) {\n\t\tuni.showToast({ title: 'ËØ∑ËæìÂÖ•Ê≠£Á°ÆÁöÑÊâãÊú∫Âè∑', icon: 'none' })\n\t\treturn\n\t}\n\t\n\tif (!form.value.password) {\n\t\tuni.showToast({ title: 'ËØ∑ËæìÂÖ•ÂØÜÁ†Å', icon: 'none' })\n\t\treturn\n\t}\n\t\n\t// ÂØÜÁ†ÅÈïøÂ∫¶È™åËØÅ\n\tif (form.value.password.length < 6) {\n\t\tuni.showToast({ title: 'ÂØÜÁ†ÅËá≥Â∞ë6‰Ωç', icon: 'none' })\n\t\treturn\n\t}\n\n\t// Èò≤Ê≠¢ÈáçÂ§çÊèê‰∫§\n\tif (loading.value) {\n\t\treturn\n\t}\n\n\tloading.value = true\n\n\ttry {\n\t\tconst response = await userApi.login({\n\t\t\tphone: form.value.phone,\n\t\t\tpassword: form.value.password\n\t\t})\n\n\t\tif (response && response.user && response.token) {\n\t\t\t// ‰øùÂ≠òÁî®Êà∑‰ø°ÊÅØÂíåtoken\n\t\t\tsaveUserInfo(response.user, response.token)\n\t\t\t\n\t\t\tuni.showToast({ title: 'ÁôªÂΩïÊàêÂäü', icon: 'success' })\n\t\t\t\n\t\t\t// Âª∂ËøüË∑≥ËΩ¨ÔºåËÆ©Áî®Êà∑ÁúãÂà∞ÊàêÂäüÊèêÁ§∫\n\t\t\tsetTimeout(() => {\n\t\t\t\t// Â¶ÇÊûúÊúâ‰∏ä‰∏ÄÈ°µÔºåÂàôËøîÂõû‰∏ä‰∏ÄÈ°µÔºåÂê¶ÂàôË∑≥ËΩ¨Âà∞È¶ñÈ°µ\n\t\t\t\tconst pages = getCurrentPages()\n\t\t\t\tif (pages.length > 1) {\n\t\t\t\t\tuni.navigateBack()\n\t\t\t\t} else {\n\t\t\t\t\tuni.switchTab({ url: '/pages/index/index' })\n\t\t\t\t}\n\t\t\t}, 1500)\n\t\t} else {\n\t\t\tuni.showToast({ title: 'ÁôªÂΩïÂ§±Ë¥•ÔºåËØ∑ÈáçËØï', icon: 'none' })\n\t\t}\n\t} catch (error) {\n\t\tconsole.error('ÁôªÂΩïÂ§±Ë¥•:', error)\n\t\tuni.showToast({ \n\t\t\ttitle: error.message || 'ÁôªÂΩïÂ§±Ë¥•ÔºåËØ∑Ê£ÄÊü•ÁΩëÁªú', \n\t\t\ticon: 'none',\n\t\t\tduration: 2000\n\t\t})\n\t} finally {\n\t\tloading.value = false\n\t}\n}\n\nfunction goToRegister() {\n\tuni.navigateTo({ url: '/pages/user/register' })\n}\n\nfunction handleForgetPassword() {\n\tuni.showToast({ title: 'ÂäüËÉΩÂºÄÂèë‰∏≠', icon: 'none' })\n}\n\n// ÂæÆ‰ø°Âø´Êç∑ÁôªÂΩï\nasync function handleWechatLogin() {\n\t// Èò≤Ê≠¢ÈáçÂ§çÊèê‰∫§\n\tif (wechatLoading.value) {\n\t\treturn\n\t}\n\n\twechatLoading.value = true\n\n\ttry {\n\t\t// 1. Ëé∑ÂèñÂæÆ‰ø°ÁôªÂΩïÂá≠ËØÅ code\n\t\tconst loginRes = await new Promise((resolve, reject) => {\n\t\t\tuni.login({\n\t\t\t\tprovider: 'weixin',\n\t\t\t\tsuccess: resolve,\n\t\t\t\tfail: reject\n\t\t\t})\n\t\t})\n\n\t\tif (!loginRes.code) {\n\t\t\tuni.showToast({ title: 'Ëé∑ÂèñÂæÆ‰ø°ÁôªÂΩïÂá≠ËØÅÂ§±Ë¥•', icon: 'none' })\n\t\t\treturn\n\t\t}\n\n\t\t// 2. Ëé∑ÂèñÁî®Êà∑‰ø°ÊÅØÔºàÈúÄË¶ÅÁî®Êà∑ÊéàÊùÉÔºâ\n\t\tlet userInfo = null\n\t\ttry {\n\t\t\tconst userProfileRes = await new Promise((resolve, reject) => {\n\t\t\t\tuni.getUserProfile({\n\t\t\t\t\tdesc: 'Áî®‰∫éÂÆåÂñÑÁî®Êà∑ËµÑÊñô',\n\t\t\t\t\tsuccess: resolve,\n\t\t\t\t\tfail: reject\n\t\t\t\t})\n\t\t\t})\n\t\t\tuserInfo = userProfileRes.userInfo\n\t\t} catch (err) {\n\t\t\tconsole.log('Áî®Êà∑ÂèñÊ∂àÊéàÊùÉÊàñËé∑ÂèñÁî®Êà∑‰ø°ÊÅØÂ§±Ë¥•:', err)\n\t\t\t// Â¶ÇÊûúÁî®Êà∑ÊãíÁªùÊéàÊùÉÔºå‰ªçÁÑ∂ÂèØ‰ª•ÁôªÂΩïÔºåÂè™ÊòØÊ≤°ÊúâÊòµÁß∞ÂíåÂ§¥ÂÉè\n\t\t}\n\n\t\t// 3. Ë∞ÉÁî®ÂêéÁ´ØÂæÆ‰ø°ÁôªÂΩïÊé•Âè£\n\t\tconst response = await userApi.wechatLogin({\n\t\t\tcode: loginRes.code,\n\t\t\tnickName: userInfo?.nickName || '',\n\t\t\tavatarUrl: userInfo?.avatarUrl || ''\n\t\t})\n\n\t\tif (response && response.user && response.token) {\n\t\t\t// ‰øùÂ≠òÁî®Êà∑‰ø°ÊÅØÂíåtoken\n\t\t\tsaveUserInfo(response.user, response.token)\n\t\t\t\n\t\t\tuni.showToast({ title: 'ÁôªÂΩïÊàêÂäü', icon: 'success' })\n\t\t\t\n\t\t\t// Âª∂ËøüË∑≥ËΩ¨\n\t\t\tsetTimeout(() => {\n\t\t\t\tconst pages = getCurrentPages()\n\t\t\t\tif (pages.length > 1) {\n\t\t\t\t\tuni.navigateBack()\n\t\t\t\t} else {\n\t\t\t\t\tuni.switchTab({ url: '/pages/index/index' })\n\t\t\t\t}\n\t\t\t}, 1500)\n\t\t} else {\n\t\t\tuni.showToast({ title: 'ÁôªÂΩïÂ§±Ë¥•ÔºåËØ∑ÈáçËØï', icon: 'none' })\n\t\t}\n\t} catch (error) {\n\t\tconsole.error('ÂæÆ‰ø°ÁôªÂΩïÂ§±Ë¥•:', error)\n\t\tuni.showToast({ \n\t\t\ttitle: error.message || 'ÂæÆ‰ø°ÁôªÂΩïÂ§±Ë¥•ÔºåËØ∑ÈáçËØï', \n\t\t\ticon: 'none',\n\t\t\tduration: 2000\n\t\t})\n\t} finally {\n\t\twechatLoading.value = false\n\t}\n}\n</script>\n\n<style scoped>\n.container {\n\tmin-height: 100vh;\n\tbackground: linear-gradient(180deg, #007AFF 0%, #5AC8FA 100%);\n\tpadding: 100rpx 60rpx;\n}\n\n.logo-section {\n\tdisplay: flex;\n\tflex-direction: column;\n\talign-items: center;\n\tmargin-bottom: 100rpx;\n}\n\n.logo {\n\twidth: 150rpx;\n\theight: 150rpx;\n\tmargin-bottom: 30rpx;\n}\n\n.app-name {\n\tfont-size: 40rpx;\n\tcolor: #fff;\n\tfont-weight: bold;\n}\n\n.form-section {\n\tbackground-color: #fff;\n\tborder-radius: 20rpx;\n\tpadding: 60rpx 40rpx;\n}\n\n.input-group {\n\tdisplay: flex;\n\talign-items: center;\n\tbackground-color: #F5F5F5;\n\tborder-radius: 10rpx;\n\tpadding: 0 20rpx;\n\tmargin-bottom: 30rpx;\n\theight: 88rpx;\n}\n\n.input-icon {\n\tfont-size: 24rpx;\n\tmargin-right: 20rpx;\n}\n\n.input {\n\tflex: 1;\n\tfont-size: 28rpx;\n\tmargin-left: 0;\n}\n\n.login-btn {\n\twidth: 100%;\n\theight: 88rpx;\n\tbackground-color: #007AFF;\n\tcolor: #fff;\n\tborder-radius: 50rpx;\n\tfont-size: 32rpx;\n\tmargin-top: 40rpx;\n\tborder: none;\n}\n\n.footer-links {\n\tdisplay: flex;\n\tjustify-content: space-between;\n\tmargin-top: 40rpx;\n}\n\n.link {\n\tfont-size: 26rpx;\n\tcolor: #007AFF;\n}\n\n.divider {\n\tdisplay: flex;\n\talign-items: center;\n\tmargin: 40rpx 0;\n}\n\n.divider-line {\n\tflex: 1;\n\theight: 1rpx;\n\tbackground-color: #E5E5E5;\n}\n\n.divider-text {\n\tmargin: 0 20rpx;\n\tfont-size: 24rpx;\n\tcolor: #999;\n}\n\n.wechat-login-btn {\n\twidth: 100%;\n\theight: 88rpx;\n\tbackground-color: #07C160;\n\tcolor: #fff;\n\tborder-radius: 50rpx;\n\tfont-size: 32rpx;\n\tmargin-top: 20rpx;\n\tborder: none;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n}\n\n.wechat-icon {\n\tfont-size: 36rpx;\n\tmargin-right: 10rpx;\n}\n</style>\n\n","import MiniProgramPage from 'G:/Â∞èÁ®ãÂ∫èxycyÈ°µÈù¢/SkyMark/pages/user/login.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","onLoad","isLoggedIn","uni","userApi","saveUserInfo"],"mappings":"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"}