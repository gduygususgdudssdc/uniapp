{"version":3,"file":"list.js","sources":["pages/order/list.vue","../../hbuildx/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvb3JkZXIvbGlzdC52dWU"],"sourcesContent":["<template>\n\t<view class=\"container\">\n\t\t<!-- 订单状态标签 -->\n\t\t<view class=\"tabs\">\n\t\t\t<view class=\"tab-item\" :class=\"{ active: currentTab === item.value }\" \n\t\t\t\tv-for=\"item in tabs\" :key=\"item.value\" @click=\"switchTab(item.value)\">\n\t\t\t\t<text>{{ item.label }}</text>\n\t\t\t</view>\n\t\t</view>\n\t\t\n\t\t<!-- 订单列表 -->\n\t\t<view class=\"order-list\">\n\t\t\t<view class=\"order-item\" v-for=\"item in orderList\" :key=\"item.id\" @click=\"goToDetail(item.id)\">\n\t\t\t\t<view class=\"order-header\">\n\t\t\t\t\t<text class=\"order-no\">订单号：{{ item.id }}</text>\n\t\t\t\t\t<text class=\"order-status\" :class=\"item.status\">{{ getStatusText(item.status) }}</text>\n\t\t\t\t</view>\n\t\t\t\t<view class=\"order-goods\">\n\t\t\t\t\t<image class=\"goods-image\" :src=\"item.goodsImage\" mode=\"aspectFill\"></image>\n\t\t\t\t\t<view class=\"goods-info\">\n\t\t\t\t\t\t<text class=\"goods-title\">{{ item.goodsTitle }}</text>\n\t\t\t\t\t\t<view class=\"goods-meta\">\n\t\t\t\t\t\t\t<text class=\"goods-price\">¥{{ item.price }}</text>\n\t\t\t\t\t\t\t<text class=\"goods-quantity\">x{{ item.quantity }}</text>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\t\t\t\t<view class=\"order-footer\">\n\t\t\t\t\t<text class=\"order-time\">{{ item.createTime }}</text>\n\t\t\t\t\t<text class=\"order-total\">合计：¥{{ item.totalPrice }}</text>\n\t\t\t\t</view>\n\t\t\t\t<view class=\"order-actions\" v-if=\"item.status === 'pending'\">\n\t\t\t\t\t<button class=\"action-btn\" @click.stop=\"cancelOrder(item.id)\">取消订单</button>\n\t\t\t\t\t<button class=\"action-btn primary\" @click.stop=\"payOrder(item.id)\">立即支付</button>\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t</view>\n\t\t\n\t\t<!-- 空状态 -->\n\t\t<view v-if=\"orderList.length === 0 && !loading\" class=\"empty\">\n\t\t\t<text>暂无订单</text>\n\t\t</view>\n\t\t\n\t\t<!-- 加载中 -->\n\t\t<view v-if=\"loading\" class=\"loading\">\n\t\t\t<text>加载中...</text>\n\t\t</view>\n\t</view>\n</template>\n\n<script setup>\nimport { ref } from 'vue'\nimport { onLoad, onShow } from '@dcloudio/uni-app'\nimport { orderApi } from '@/utils/apiService.js'\nimport { getCurrentUserId, checkLogin } from '@/utils/auth.js'\n\nconst orderList = ref([])\nconst userId = ref(null)\nconst currentTab = ref('all')\nconst loading = ref(false)\nconst tabs = ref([\n\t{ label: '全部', value: 'all' },\n\t{ label: '待付款', value: 'pending' },\n\t{ label: '待发货', value: 'paid' },\n\t{ label: '已完成', value: 'completed' }\n])\n\n// 加载订单列表\nasync function loadOrders() {\n\t// 检查登录状态\n\tif (!checkLogin()) {\n\t\treturn\n\t}\n\t\n\tconst currentUserId = getCurrentUserId()\n\tif (!currentUserId) {\n\t\tuni.showToast({ title: '获取用户信息失败', icon: 'none' })\n\t\treturn\n\t}\n\t\n\tuserId.value = currentUserId\n\tloading.value = true\n\t\n\ttry {\n\t\t// 如果选择的是\"全部\"，不传status参数\n\t\tconst status = currentTab.value === 'all' ? '' : currentTab.value\n\t\tconst orders = await orderApi.getOrderList(currentUserId, status)\n\t\t\n\t\t// 处理订单数据\n\t\tif (Array.isArray(orders)) {\n\t\t\torderList.value = orders.map(order => {\n\t\t\t\t// 处理商品图片（如果是JSON字符串，转换为数组）\n\t\t\t\tif (order.goodsImage && typeof order.goodsImage === 'string') {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tconst images = JSON.parse(order.goodsImage)\n\t\t\t\t\t\torder.goodsImage = Array.isArray(images) ? images[0] : images\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t// 保持原样\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn order\n\t\t\t})\n\t\t} else {\n\t\t\torderList.value = []\n\t\t}\n\t} catch (error) {\n\t\tconsole.error('加载订单失败:', error)\n\t\tuni.showToast({ \n\t\t\ttitle: error.message || '加载订单失败', \n\t\t\ticon: 'none',\n\t\t\tduration: 2000\n\t\t})\n\t\torderList.value = []\n\t} finally {\n\t\tloading.value = false\n\t}\n}\nfunction getStatusText(status) {\n\tconst map = {\n\t\tpending: '待付款',\n\t\tpaid: '待发货',\n\t\tshipped: '已发货',\n\t\tcompleted: '已完成',\n\t\tcancelled: '已取消'\n\t}\n\treturn map[status] || ''\n}\n// 切换标签\nfunction switchTab(value) {\n\tcurrentTab.value = value\n\tloadOrders()\n}\n\n// 跳转到订单详情\nfunction goToDetail(id) {\n\tuni.navigateTo({\n\t\turl: `/pages/order/detail?id=${id}`\n\t})\n}\n\n// 取消订单\nasync function cancelOrder(id) {\n\tuni.showModal({\n\t\ttitle: '提示',\n\t\tcontent: '确定要取消此订单吗？',\n\t\tsuccess: async (res) => {\n\t\t\tif (res.confirm) {\n\t\t\t\ttry {\n\t\t\t\t\tawait orderApi.cancelOrder(id)\n\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\ttitle: '订单已取消',\n\t\t\t\t\t\ticon: 'success'\n\t\t\t\t\t})\n\t\t\t\t\tloadOrders()\n\t\t\t\t} catch (error) {\n\t\t\t\t\tconsole.error('取消订单失败:', error)\n\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\ttitle: error.message || '取消订单失败',\n\t\t\t\t\t\ticon: 'none'\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t})\n}\n\n// 支付订单\nasync function payOrder(id) {\n\ttry {\n\t\tawait orderApi.payOrder(id)\n\t\tuni.showToast({\n\t\t\ttitle: '支付成功',\n\t\t\ticon: 'success'\n\t\t})\n\t\tloadOrders()\n\t} catch (error) {\n\t\tconsole.error('支付失败:', error)\n\t\tuni.showToast({\n\t\t\ttitle: error.message || '支付失败',\n\t\t\ticon: 'none'\n\t\t})\n\t}\n}\nonLoad(() => {\n\tloadOrders()\n})\nonShow(() => {\n\tloadOrders()\n})\n</script>\n\n<style scoped>\n.container {\n\tmin-height: 100vh;\n\tbackground-color: #F5F5F5;\n}\n\n.tabs {\n\tdisplay: flex;\n\tbackground-color: #fff;\n\tpadding: 0 20rpx;\n\tborder-bottom: 1rpx solid #eee;\n}\n\n.tab-item {\n\tflex: 1;\n\ttext-align: center;\n\tpadding: 30rpx 0;\n\tfont-size: 28rpx;\n\tcolor: #666;\n\tposition: relative;\n}\n\n.tab-item.active {\n\tcolor: #007AFF;\n\tfont-weight: bold;\n}\n\n.tab-item.active::after {\n\tcontent: '';\n\tposition: absolute;\n\tbottom: 0;\n\tleft: 50%;\n\ttransform: translateX(-50%);\n\twidth: 60rpx;\n\theight: 4rpx;\n\tbackground-color: #007AFF;\n}\n\n.order-list {\n\tpadding: 20rpx;\n}\n\n.order-item {\n\tbackground-color: #fff;\n\tborder-radius: 10rpx;\n\tpadding: 30rpx;\n\tmargin-bottom: 20rpx;\n}\n\n.order-header {\n\tdisplay: flex;\n\tjustify-content: space-between;\n\talign-items: center;\n\tmargin-bottom: 20rpx;\n\tpadding-bottom: 20rpx;\n\tborder-bottom: 1rpx solid #eee;\n}\n\n.order-no {\n\tfont-size: 24rpx;\n\tcolor: #999;\n}\n\n.order-status {\n\tfont-size: 26rpx;\n\tfont-weight: bold;\n}\n\n.order-status.pending {\n\tcolor: #FF9800;\n}\n\n.order-status.paid {\n\tcolor: #2196F3;\n}\n\n.order-status.completed {\n\tcolor: #4CAF50;\n}\n\n.order-goods {\n\tdisplay: flex;\n\tmargin-bottom: 20rpx;\n}\n\n.goods-image {\n\twidth: 150rpx;\n\theight: 150rpx;\n\tborder-radius: 10rpx;\n\tmargin-right: 20rpx;\n}\n\n.goods-info {\n\tflex: 1;\n\tdisplay: flex;\n\tflex-direction: column;\n\tjustify-content: space-between;\n}\n\n.goods-title {\n\tfont-size: 28rpx;\n\tcolor: #333;\n\tmargin-bottom: 10rpx;\n}\n\n.goods-meta {\n\tdisplay: flex;\n\tjustify-content: space-between;\n\talign-items: center;\n}\n\n.goods-price {\n\tfont-size: 30rpx;\n\tcolor: #FF5722;\n\tfont-weight: bold;\n}\n\n.goods-quantity {\n\tfont-size: 24rpx;\n\tcolor: #999;\n}\n\n.order-footer {\n\tdisplay: flex;\n\tjustify-content: space-between;\n\talign-items: center;\n\tmargin-bottom: 20rpx;\n\tpadding-top: 20rpx;\n\tborder-top: 1rpx solid #eee;\n}\n\n.order-time {\n\tfont-size: 24rpx;\n\tcolor: #999;\n}\n\n.order-total {\n\tfont-size: 28rpx;\n\tcolor: #333;\n\tfont-weight: bold;\n}\n\n.order-actions {\n\tdisplay: flex;\n\tjustify-content: flex-end;\n\tgap: 20rpx;\n}\n\n.action-btn {\n\tpadding: 10rpx 30rpx;\n\tbackground-color: #F5F5F5;\n\tcolor: #333;\n\tborder-radius: 30rpx;\n\tfont-size: 24rpx;\n\tborder: none;\n}\n\n.action-btn.primary {\n\tbackground-color: #007AFF;\n\tcolor: #fff;\n}\n\n.empty {\n\tdisplay: flex;\n\tjustify-content: center;\n\talign-items: center;\n\tpadding: 100rpx 0;\n\tcolor: #999;\n}\n\n.loading {\n\tdisplay: flex;\n\tjustify-content: center;\n\talign-items: center;\n\tpadding: 100rpx 0;\n\tcolor: #999;\n}\n</style>\n\n\n\n\n\n","import MiniProgramPage from 'G:/小程序xycy页面/SkyMark/pages/order/list.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","checkLogin","getCurrentUserId","uni","orderApi","onLoad","onShow"],"mappings":"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"}