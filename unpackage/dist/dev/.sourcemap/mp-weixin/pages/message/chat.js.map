{"version":3,"file":"chat.js","sources":["pages/message/chat.vue","../../hbuildx/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvbWVzc2FnZS9jaGF0LnZ1ZQ"],"sourcesContent":["<template>\n\t<view class=\"container\">\n\t\t<scroll-view \n\t\t\tclass=\"chat-list\" \n\t\t\tscroll-y \n\t\t\t:scroll-top=\"scrollTop\"\n\t\t\t:scroll-with-animation=\"true\"\n\t\t\t@scrolltolower=\"loadMoreMessages\"\n\t\t>\n\t\t\t<view class=\"chat-item\" :class=\"{ self: item.senderId === currentUserId }\" \n\t\t\t\tv-for=\"item in chatMessages\" :key=\"item.id\">\n\t\t\t\t<image v-if=\"item.senderId === currentUserId\" class=\"avatar\" \n\t\t\t\t\t:src=\"userAvatar\" mode=\"aspectFill\"></image>\n\t\t\t\t<view class=\"message-bubble\">\n\t\t\t\t\t<text class=\"message-text\">{{ item.content }}</text>\n\t\t\t\t\t<text class=\"message-time\">{{ formatTime(item.createTime) }}</text>\n\t\t\t\t</view>\n\t\t\t\t<image v-if=\"item.senderId !== currentUserId\" class=\"avatar\" \n\t\t\t\t\t:src=\"targetAvatar\" mode=\"aspectFill\"></image>\n\t\t\t</view>\n\t\t\t\n\t\t\t<!-- 加载中提示 -->\n\t\t\t<view v-if=\"loading\" class=\"loading\">\n\t\t\t\t<text>加载中...</text>\n\t\t\t</view>\n\t\t</scroll-view>\n\t\t\n\t\t<!-- 输入栏 -->\n\t\t<view class=\"input-bar\">\n\t\t\t<input \n\t\t\t\tclass=\"input\" \n\t\t\t\tv-model=\"inputText\" \n\t\t\t\tplaceholder=\"输入消息...\" \n\t\t\t\t@confirm=\"sendMessage\"\n\t\t\t\t:focus=\"inputFocus\"\n\t\t\t/>\n\t\t\t<view class=\"send-btn\" @click=\"sendMessage\">\n\t\t\t\t<text class=\"send-text\">发送</text>\n\t\t\t</view>\n\t\t</view>\n\t</view>\n</template>\n\n<script setup>\nimport { ref, onMounted, onUnmounted, nextTick } from 'vue'\nimport { onLoad, onShow, onHide } from '@dcloudio/uni-app'\nimport { messageApi, userApi } from '@/utils/apiService.js'\nimport { getCurrentUserId, getCurrentUser, checkLogin } from '@/utils/auth.js'\nimport wsManager from '@/utils/websocket.js'\n\nconst userId = ref('') // 对方用户ID\nconst currentUserId = ref(null) // 当前登录用户ID\nconst chatMessages = ref([])\nconst inputText = ref('')\nconst userAvatar = ref('')\nconst targetAvatar = ref('')\nconst targetUser = ref(null)\nconst scrollTop = ref(0)\nconst loading = ref(false)\nconst inputFocus = ref(false)\nlet isInitialLoad = true // 标记是否为初始加载\n\n// 加载聊天记录\nasync function loadChat() {\n\tif (!currentUserId.value || !userId.value) return\n\t\n\ttry {\n\t\tif (isInitialLoad) {\n\t\t\tloading.value = true\n\t\t}\n\t\tconst messages = await messageApi.getChatMessages(currentUserId.value, parseInt(userId.value))\n\t\tchatMessages.value = messages || []\n\t\t\n\t\t// 标记消息为已读\n\t\tawait messageApi.markAsRead(currentUserId.value, parseInt(userId.value))\n\t\t\n\t\t// 滚动到底部\n\t\tawait nextTick()\n\t\tscrollToBottom()\n\t\t\n\t\tif (isInitialLoad) {\n\t\t\tisInitialLoad = false\n\t\t}\n\t} catch (error) {\n\t\tconsole.error('加载聊天记录失败:', error)\n\t\tuni.showToast({ title: '加载失败', icon: 'none' })\n\t} finally {\n\t\tloading.value = false\n\t}\n}\n\n// 加载用户信息\nasync function loadUserInfo() {\n\ttry {\n\t\t// 加载当前用户信息\n\t\tconst currentUser = getCurrentUser()\n\t\tif (currentUser) {\n\t\t\tuserAvatar.value = currentUser.avatar || '/static/default-avatar.png'\n\t\t}\n\t\t\n\t\t// 加载对方用户信息\n\t\tconst targetId = parseInt(userId.value)\n\t\tconst user = await userApi.getUserInfo(targetId)\n\t\tif (user) {\n\t\t\ttargetUser.value = user\n\t\t\ttargetAvatar.value = user.avatar || '/static/default-avatar.png'\n\t\t\t// 设置导航栏标题\n\t\t\tuni.setNavigationBarTitle({\n\t\t\t\ttitle: user.username || '聊天'\n\t\t\t})\n\t\t}\n\t} catch (error) {\n\t\tconsole.error('加载用户信息失败:', error)\n\t}\n}\n\n// WebSocket 消息处理\nfunction handleWebSocketMessage(data) {\n\tconsole.log('=== 前端收到 WebSocket 消息 ===')\n\tconsole.log('消息内容:', JSON.stringify(data, null, 2))\n\tconsole.log('消息类型:', data.type)\n\tconsole.log('当前用户ID:', currentUserId.value)\n\tconsole.log('对方用户ID:', userId.value)\n\t\n\tif (data.type === 'MESSAGE') {\n\t\t// 收到新消息\n\t\tconst message = {\n\t\t\tid: data.id,\n\t\t\tsenderId: data.senderId,\n\t\t\treceiverId: data.receiverId,\n\t\t\tcontent: data.content,\n\t\t\tcreateTime: data.createTime,\n\t\t\tisRead: data.isRead\n\t\t}\n\t\t\n\t\tconsole.log('解析后的消息:', message)\n\t\tconsole.log('当前消息列表长度:', chatMessages.value.length)\n\t\t\n\t\t// 检查是否已存在（避免重复）\n\t\tconst exists = chatMessages.value.some(m => m.id === message.id)\n\t\tconsole.log('消息是否已存在:', exists)\n\t\t\n\t\tif (!exists) {\n\t\t\tconsole.log('✓ 添加新消息到列表')\n\t\t\tchatMessages.value.push(message)\n\t\t\tconsole.log('添加后消息列表长度:', chatMessages.value.length)\n\t\t\t\n\t\t\t// 如果是对方发来的消息，标记为已读\n\t\t\tif (message.senderId !== currentUserId.value) {\n\t\t\t\tconsole.log('标记消息为已读')\n\t\t\t\twsManager.send('READ', {\n\t\t\t\t\tsenderId: message.senderId,\n\t\t\t\t\treceiverId: currentUserId.value\n\t\t\t\t})\n\t\t\t}\n\t\t\t\n\t\t\t// 滚动到底部\n\t\t\tnextTick(() => {\n\t\t\t\tconsole.log('滚动到底部')\n\t\t\t\tscrollToBottom()\n\t\t\t})\n\t\t} else {\n\t\t\tconsole.log('⚠ 消息已存在，跳过')\n\t\t}\n\t} else if (data.type === 'ERROR') {\n\t\tconsole.error('收到错误消息:', data.content)\n\t\tuni.showToast({ title: data.content || '操作失败', icon: 'none' })\n\t} else {\n\t\tconsole.warn('未知消息类型:', data.type)\n\t}\n}\n\n// 发送消息\nfunction sendMessage() {\n\tif (!inputText.value.trim()) return\n\t\n\tif (!checkLogin()) return\n\t\n\tif (!currentUserId.value || !userId.value) {\n\t\tuni.showToast({ title: '用户信息错误', icon: 'none' })\n\t\treturn\n\t}\n\t\n\tconst content = inputText.value.trim()\n\tinputText.value = ''\n\t\n\t// 立即显示消息（乐观更新）\n\tconst tempMessage = {\n\t\tid: Date.now(), // 临时ID\n\t\tsenderId: currentUserId.value,\n\t\treceiverId: parseInt(userId.value),\n\t\tcontent: content,\n\t\tcreateTime: new Date().toISOString(),\n\t\tisRead: false\n\t}\n\tchatMessages.value.push(tempMessage)\n\t\n\t// 滚动到底部\n\tnextTick(() => {\n\t\tscrollToBottom()\n\t})\n\t\n\t// 通过 WebSocket 发送消息\n\tconst success = wsManager.send('SEND', {\n\t\tsenderId: currentUserId.value,\n\t\treceiverId: parseInt(userId.value),\n\t\tcontent: content\n\t})\n\t\n\tif (!success) {\n\t\t// WebSocket 未连接，使用 HTTP API 作为后备\n\t\tsendMessageByHttp(tempMessage, content)\n\t}\n}\n\n// 使用 HTTP API 发送消息（后备方案）\nasync function sendMessageByHttp(tempMessage, content) {\n\ttry {\n\t\tconst messageData = {\n\t\t\tsenderId: currentUserId.value,\n\t\t\treceiverId: parseInt(userId.value),\n\t\t\tcontent: content\n\t\t}\n\t\tconst savedMessage = await messageApi.sendMessage(messageData)\n\t\t\n\t\t// 替换临时消息\n\t\tconst index = chatMessages.value.findIndex(m => m.id === tempMessage.id)\n\t\tif (index !== -1) {\n\t\t\tchatMessages.value[index] = savedMessage\n\t\t}\n\t} catch (error) {\n\t\tconsole.error('发送消息失败:', error)\n\t\tuni.showToast({ title: '发送失败', icon: 'none' })\n\t\t// 移除失败的消息\n\t\tchatMessages.value = chatMessages.value.filter(m => m.id !== tempMessage.id)\n\t}\n}\n\n// 滚动到底部\nfunction scrollToBottom() {\n\tnextTick(() => {\n\t\tscrollTop.value = 99999\n\t})\n}\n\n// 加载更多消息（分页）\nfunction loadMoreMessages() {\n\t// 可以在这里实现分页加载\n}\n\n// 连接 WebSocket\nfunction connectWebSocket() {\n\tif (!currentUserId.value) {\n\t\tconsole.error('无法连接 WebSocket: 用户ID为空')\n\t\treturn\n\t}\n\t\n\tconsole.log('开始连接 WebSocket, 用户ID:', currentUserId.value)\n\t\n\twsManager.connect(\n\t\tcurrentUserId.value.toString(),\n\t\thandleWebSocketMessage,\n\t\t(error) => {\n\t\t\tconsole.error('WebSocket 连接错误:', error)\n\t\t\tuni.showToast({ \n\t\t\t\ttitle: 'WebSocket 连接失败，请检查网络', \n\t\t\t\ticon: 'none',\n\t\t\t\tduration: 2000\n\t\t\t})\n\t\t}\n\t)\n}\n\n// 断开 WebSocket\nfunction disconnectWebSocket() {\n\twsManager.disconnect()\n}\n\n// 格式化时间\nfunction formatTime(time) {\n\tif (!time) return ''\n\tconst date = new Date(time)\n\tconst now = new Date()\n\tconst diff = now - date\n\tconst minutes = Math.floor(diff / 60000)\n\tconst hours = Math.floor(diff / 3600000)\n\tconst days = Math.floor(diff / 86400000)\n\t\n\tif (minutes < 1) return '刚刚'\n\tif (minutes < 60) return `${minutes}分钟前`\n\tif (hours < 24) return `${hours}小时前`\n\tif (days === 1) return '昨天'\n\tif (days < 7) return `${days}天前`\n\t\n\treturn `${date.getMonth() + 1}-${date.getDate()} ${date.getHours()}:${String(date.getMinutes()).padStart(2, '0')}`\n}\n\nonLoad((options) => {\n\tif (options.userId) {\n\t\tuserId.value = options.userId\n\t\tcurrentUserId.value = getCurrentUserId()\n\t\t\n\t\tif (!currentUserId.value) {\n\t\t\tcheckLogin()\n\t\t\treturn\n\t\t}\n\t\t\n\t\tloadUserInfo()\n\t\tloadChat()\n\t\tconnectWebSocket()\n\t} else {\n\t\tuni.showToast({ title: '参数错误', icon: 'none' })\n\t\tsetTimeout(() => {\n\t\t\tuni.navigateBack()\n\t\t}, 1500)\n\t}\n})\n\nonShow(() => {\n\tif (currentUserId.value && userId.value) {\n\t\tisInitialLoad = false\n\t\tloadChat()\n\t\t// 如果 WebSocket 未连接，重新连接\n\t\tif (!wsManager.isConnected) {\n\t\t\tconnectWebSocket()\n\t\t}\n\t}\n})\n\nonHide(() => {\n\t// 页面隐藏时不立即断开，保持连接以便接收消息\n\t// 如果需要节省资源，可以在这里断开\n\t// disconnectWebSocket()\n})\n\nonUnmounted(() => {\n\tdisconnectWebSocket()\n})\n</script>\n\n<style scoped>\n.container {\n\tmin-height: 100vh;\n\tbackground-color: transparent;\n\tpadding-bottom: 120rpx;\n\tdisplay: flex;\n\tflex-direction: column;\n}\n\n.chat-list {\n\tflex: 1;\n\tpadding: 20rpx;\n\theight: calc(100vh - 120rpx);\n}\n\n.chat-item {\n\tdisplay: flex;\n\talign-items: flex-start;\n\tmargin-bottom: 30rpx;\n}\n\n.chat-item.self {\n\tflex-direction: row-reverse;\n}\n\n.avatar {\n\twidth: 60rpx;\n\theight: 60rpx;\n\tborder-radius: 50%;\n\tmargin: 0 20rpx;\n\tflex-shrink: 0;\n}\n\n.message-bubble {\n\tmax-width: 60%;\n\tbackground-color: #fff;\n\tborder-radius: 10rpx;\n\tpadding: 20rpx;\n\tbox-shadow: 0 2rpx 10rpx rgba(0, 0, 0, 0.1);\n\tdisplay: flex;\n\tflex-direction: column;\n}\n\n.chat-item.self .message-bubble {\n\tbackground-color: #007AFF;\n}\n\n.message-text {\n\tfont-size: 28rpx;\n\tcolor: #333;\n\tline-height: 1.5;\n\tword-break: break-word;\n}\n\n.chat-item.self .message-text {\n\tcolor: #fff;\n}\n\n.message-time {\n\tfont-size: 20rpx;\n\tcolor: #999;\n\tmargin-top: 10rpx;\n\talign-self: flex-end;\n}\n\n.chat-item.self .message-time {\n\tcolor: rgba(255, 255, 255, 0.7);\n}\n\n.input-bar {\n\tposition: fixed;\n\tbottom: 0;\n\tleft: 0;\n\tright: 0;\n\tdisplay: flex;\n\talign-items: center;\n\tbackground-color: #fff;\n\tpadding: 20rpx;\n\tborder-top: 1rpx solid #eee;\n\tz-index: 999;\n}\n\n.input {\n\tflex: 1;\n\theight: 70rpx;\n\tbackground-color: #F5F5F5;\n\tborder-radius: 35rpx;\n\tpadding: 0 30rpx;\n\tfont-size: 28rpx;\n\tmargin-right: 20rpx;\n}\n\n.send-btn {\n\twidth: 120rpx;\n\theight: 70rpx;\n\tbackground-color: #007AFF;\n\tborder-radius: 35rpx;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n}\n\n.send-text {\n\tcolor: #fff;\n\tfont-size: 28rpx;\n}\n\n.loading {\n\ttext-align: center;\n\tpadding: 20rpx;\n\tcolor: #999;\n\tfont-size: 24rpx;\n}\n</style>\n","import MiniProgramPage from 'G:/小程序xycy页面/SkyMark/pages/message/chat.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","messageApi","nextTick","uni","getCurrentUser","userApi","wsManager","checkLogin","onLoad","getCurrentUserId","onShow","onHide","onUnmounted"],"mappings":"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"}