{"version":3,"file":"list.js","sources":["pages/message/list.vue","../../hbuildx/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvbWVzc2FnZS9saXN0LnZ1ZQ"],"sourcesContent":["<template>\n\t<view class=\"container\">\n\t\t<view class=\"message-list\">\n\t\t\t<view class=\"message-item\" v-for=\"item in messageList\" :key=\"item.userId\" @click=\"goToChat(item.userId)\">\n\t\t\t\t<image class=\"avatar\" :src=\"item.avatar || '/static/default-avatar.png'\" mode=\"aspectFill\"></image>\n\t\t\t\t<view class=\"message-content\">\n\t\t\t\t\t<view class=\"message-header\">\n\t\t\t\t\t\t<text class=\"username\">{{ item.username }}</text>\n\t\t\t\t\t\t<text class=\"time\">{{ formatTime(item.lastTime) }}</text>\n\t\t\t\t\t</view>\n\t\t\t\t\t<view class=\"message-body\">\n\t\t\t\t\t\t<text class=\"last-message\">{{ item.lastMessage || 'ÊöÇÊó†Ê∂àÊÅØ' }}</text>\n\t\t\t\t\t\t<view class=\"unread-badge\" v-if=\"item.unreadCount > 0\">\n\t\t\t\t\t\t\t<text>{{ item.unreadCount > 99 ? '99+' : item.unreadCount }}</text>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t</view>\n\t\t\n\t\t<!-- Á©∫Áä∂ÊÄÅ -->\n\t\t<view v-if=\"messageList.length === 0 && !loading\" class=\"empty\">\n\t\t\t<text class=\"empty-icon\">üí¨</text>\n\t\t\t<text class=\"empty-text\">ÊöÇÊó†Ê∂àÊÅØ</text>\n\t\t</view>\n\t\t\n\t\t<!-- Âä†ËΩΩ‰∏≠ -->\n\t\t<view v-if=\"loading\" class=\"loading\">\n\t\t\t<text>Âä†ËΩΩ‰∏≠...</text>\n\t\t</view>\n\t</view>\n</template>\n\n<script setup>\nimport { ref, onMounted, onUnmounted } from 'vue'\nimport { onLoad, onShow } from '@dcloudio/uni-app'\nimport { messageApi } from '@/utils/apiService.js'\nimport { getCurrentUserId, checkLogin } from '@/utils/auth.js'\n\nconst messageList = ref([])\nconst loading = ref(false)\nconst currentUserId = ref(null)\nlet pollTimer = null\n\n// Âä†ËΩΩÊ∂àÊÅØÂàóË°®\nasync function loadMessages() {\n\tif (!currentUserId.value) {\n\t\tcurrentUserId.value = getCurrentUserId()\n\t\tif (!currentUserId.value) {\n\t\t\treturn\n\t\t}\n\t}\n\t\n\ttry {\n\t\tloading.value = true\n\t\tconst list = await messageApi.getMessageList(currentUserId.value)\n\t\tmessageList.value = list || []\n\t} catch (error) {\n\t\tconsole.error('Âä†ËΩΩÊ∂àÊÅØÂàóË°®Â§±Ë¥•:', error)\n\t\tuni.showToast({ title: 'Âä†ËΩΩÂ§±Ë¥•', icon: 'none' })\n\t} finally {\n\t\tloading.value = false\n\t}\n}\n\n// Ë∑≥ËΩ¨Âà∞ËÅäÂ§©È°µÈù¢\nfunction goToChat(userId) {\n\tif (!checkLogin()) return\n\tuni.navigateTo({\n\t\turl: `/pages/message/chat?userId=${userId}`\n\t})\n}\n\n// Ê†ºÂºèÂåñÊó∂Èó¥\nfunction formatTime(time) {\n\tif (!time) return ''\n\tconst date = new Date(time)\n\tconst now = new Date()\n\tconst diff = now - date\n\tconst minutes = Math.floor(diff / 60000)\n\tconst hours = Math.floor(diff / 3600000)\n\tconst days = Math.floor(diff / 86400000)\n\t\n\tif (minutes < 1) return 'ÂàöÂàö'\n\tif (minutes < 60) return `${minutes}ÂàÜÈíüÂâç`\n\tif (hours < 24) return `${hours}Â∞èÊó∂Ââç`\n\tif (days === 1) return 'Êò®Â§©'\n\tif (days < 7) return `${days}Â§©Ââç`\n\t\n\treturn `${date.getMonth() + 1}-${date.getDate()}`\n}\n\n// ËΩÆËØ¢Êõ¥Êñ∞Ê∂àÊÅØÂàóË°®\nfunction startPolling() {\n\tpollTimer = setInterval(() => {\n\t\tif (currentUserId.value) {\n\t\t\tloadMessages()\n\t\t}\n\t}, 5000) // ÊØè5ÁßíÂà∑Êñ∞‰∏ÄÊ¨°\n}\n\n// ÂÅúÊ≠¢ËΩÆËØ¢\nfunction stopPolling() {\n\tif (pollTimer) {\n\t\tclearInterval(pollTimer)\n\t\tpollTimer = null\n\t}\n}\n\nonLoad(() => {\n\tcurrentUserId.value = getCurrentUserId()\n\tif (currentUserId.value) {\n\t\tloadMessages()\n\t\tstartPolling()\n\t}\n})\n\nonShow(() => {\n\tif (currentUserId.value) {\n\t\tloadMessages()\n\t\tstartPolling()\n\t}\n})\n\nonUnmounted(() => {\n\tstopPolling()\n})\n</script>\n\n<style scoped>\n.container {\n\tmin-height: 100vh;\n\tbackground-color: transparent;\n}\n\n.message-list {\n\tpadding: 20rpx;\n}\n\n.message-item {\n\tdisplay: flex;\n\tbackground-color: rgba(255, 255, 255, 0.9);\n\tborder-radius: 10rpx;\n\tpadding: 30rpx;\n\tmargin-bottom: 20rpx;\n\tbox-shadow: 0 2rpx 10rpx rgba(0, 0, 0, 0.05);\n}\n\n.avatar {\n\twidth: 100rpx;\n\theight: 100rpx;\n\tborder-radius: 50%;\n\tmargin-right: 20rpx;\n\tflex-shrink: 0;\n}\n\n.message-content {\n\tflex: 1;\n\tdisplay: flex;\n\tflex-direction: column;\n\tjustify-content: space-between;\n}\n\n.message-header {\n\tdisplay: flex;\n\tjustify-content: space-between;\n\talign-items: center;\n\tmargin-bottom: 10rpx;\n}\n\n.username {\n\tfont-size: 30rpx;\n\tcolor: #333;\n\tfont-weight: bold;\n}\n\n.time {\n\tfont-size: 24rpx;\n\tcolor: #999;\n}\n\n.message-body {\n\tdisplay: flex;\n\tjustify-content: space-between;\n\talign-items: center;\n}\n\n.last-message {\n\tflex: 1;\n\tfont-size: 26rpx;\n\tcolor: #666;\n\toverflow: hidden;\n\ttext-overflow: ellipsis;\n\twhite-space: nowrap;\n\tmargin-right: 20rpx;\n}\n\n.unread-badge {\n\tmin-width: 36rpx;\n\theight: 36rpx;\n\tbackground-color: #FF5722;\n\tborder-radius: 18rpx;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\tpadding: 0 12rpx;\n}\n\n.unread-badge text {\n\tfont-size: 20rpx;\n\tcolor: #fff;\n\tfont-weight: bold;\n}\n\n.empty {\n\tdisplay: flex;\n\tflex-direction: column;\n\talign-items: center;\n\tjustify-content: center;\n\tpadding: 200rpx 0;\n}\n\n.empty-icon {\n\tfont-size: 120rpx;\n\tmargin-bottom: 30rpx;\n}\n\n.empty-text {\n\tfont-size: 28rpx;\n\tcolor: #999;\n}\n\n.loading {\n\ttext-align: center;\n\tpadding: 40rpx 0;\n\tcolor: #999;\n\tfont-size: 28rpx;\n}\n</style>\n","import MiniProgramPage from 'G:/Â∞èÁ®ãÂ∫èxycyÈ°µÈù¢/SkyMark/pages/message/list.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","getCurrentUserId","messageApi","uni","checkLogin","onLoad","onShow","onUnmounted"],"mappings":";;;;;;;AAuCA,UAAM,cAAcA,cAAG,IAAC,EAAE;AAC1B,UAAM,UAAUA,cAAG,IAAC,KAAK;AACzB,UAAM,gBAAgBA,cAAG,IAAC,IAAI;AAC9B,QAAI,YAAY;AAGhB,mBAAe,eAAe;AAC7B,UAAI,CAAC,cAAc,OAAO;AACzB,sBAAc,QAAQC,4BAAkB;AACxC,YAAI,CAAC,cAAc,OAAO;AACzB;AAAA,QACA;AAAA,MACD;AAED,UAAI;AACH,gBAAQ,QAAQ;AAChB,cAAM,OAAO,MAAMC,iBAAAA,WAAW,eAAe,cAAc,KAAK;AAChE,oBAAY,QAAQ,QAAQ,CAAE;AAAA,MAC9B,SAAQ,OAAO;AACfC,sBAAAA,qDAAc,aAAa,KAAK;AAChCA,sBAAG,MAAC,UAAU,EAAE,OAAO,QAAQ,MAAM,QAAQ;AAAA,MAC/C,UAAW;AACT,gBAAQ,QAAQ;AAAA,MAChB;AAAA,IACF;AAGA,aAAS,SAAS,QAAQ;AACzB,UAAI,CAACC,WAAU,WAAA;AAAI;AACnBD,oBAAAA,MAAI,WAAW;AAAA,QACd,KAAK,8BAA8B,MAAM;AAAA,MAC3C,CAAE;AAAA,IACF;AAGA,aAAS,WAAW,MAAM;AACzB,UAAI,CAAC;AAAM,eAAO;AAClB,YAAM,OAAO,IAAI,KAAK,IAAI;AAC1B,YAAM,MAAM,oBAAI,KAAM;AACtB,YAAM,OAAO,MAAM;AACnB,YAAM,UAAU,KAAK,MAAM,OAAO,GAAK;AACvC,YAAM,QAAQ,KAAK,MAAM,OAAO,IAAO;AACvC,YAAM,OAAO,KAAK,MAAM,OAAO,KAAQ;AAEvC,UAAI,UAAU;AAAG,eAAO;AACxB,UAAI,UAAU;AAAI,eAAO,GAAG,OAAO;AACnC,UAAI,QAAQ;AAAI,eAAO,GAAG,KAAK;AAC/B,UAAI,SAAS;AAAG,eAAO;AACvB,UAAI,OAAO;AAAG,eAAO,GAAG,IAAI;AAE5B,aAAO,GAAG,KAAK,SAAU,IAAG,CAAC,IAAI,KAAK,QAAO,CAAE;AAAA,IAChD;AAGA,aAAS,eAAe;AACvB,kBAAY,YAAY,MAAM;AAC7B,YAAI,cAAc,OAAO;AACxB,uBAAc;AAAA,QACd;AAAA,MACD,GAAE,GAAI;AAAA,IACR;AAGA,aAAS,cAAc;AACtB,UAAI,WAAW;AACd,sBAAc,SAAS;AACvB,oBAAY;AAAA,MACZ;AAAA,IACF;AAEAE,kBAAAA,OAAO,MAAM;AACZ,oBAAc,QAAQJ,4BAAkB;AACxC,UAAI,cAAc,OAAO;AACxB,qBAAc;AACd,qBAAc;AAAA,MACd;AAAA,IACF,CAAC;AAEDK,kBAAAA,OAAO,MAAM;AACZ,UAAI,cAAc,OAAO;AACxB,qBAAc;AACd,qBAAc;AAAA,MACd;AAAA,IACF,CAAC;AAEDC,kBAAAA,YAAY,MAAM;AACjB,kBAAa;AAAA,IACd,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;AC7HD,GAAG,WAAW,eAAe;"}