{"version":3,"file":"publish.js","sources":["pages/goods/publish.vue","../../hbuildx/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvZ29vZHMvcHVibGlzaC52dWU"],"sourcesContent":["<template>\n\t<view class=\"container\">\n\t\t<view class=\"form\">\n\t\t\t<view class=\"form-item\">\n\t\t\t\t<text class=\"label\">商品标题</text>\n\t\t\t\t<input class=\"input\" v-model=\"form.title\" placeholder=\"请输入商品标题\" />\n\t\t\t</view>\n\t\t\t\n\t\t\t<view class=\"form-item\">\n\t\t\t\t<text class=\"label\">商品分类</text>\n\t\t\t\t<picker \n\t\t\t\t\tmode=\"selector\" \n\t\t\t\t\t:range=\"categoryOptions\" \n\t\t\t\t\trange-key=\"name\" \n\t\t\t\t\t:value=\"categoryIndex\"\n\t\t\t\t\t@change=\"onCategoryChange\">\n\t\t\t\t\t<view class=\"picker\">\n\t\t\t\t\t\t<text :class=\"{ placeholder: !form.categoryName }\">\n\t\t\t\t\t\t\t{{ form.categoryName || '请选择分类' }}\n\t\t\t\t\t\t</text>\n\t\t\t\t\t\t<text class=\"picker-arrow\">›</text>\n\t\t\t\t\t</view>\n\t\t\t\t</picker>\n\t\t\t</view>\n\t\t\t\n\t\t\t<view class=\"form-item\">\n\t\t\t\t<text class=\"label\">商品图片</text>\n\t\t\t\t<view class=\"upload-images\">\n\t\t\t\t\t<view class=\"image-item\" v-for=\"(img, index) in form.images\" :key=\"index\">\n\t\t\t\t\t\t<image :src=\"img\" mode=\"aspectFill\"></image>\n\t\t\t\t\t\t<view class=\"delete-btn\" @click=\"deleteImage(index)\">×</view>\n\t\t\t\t\t</view>\n\t\t\t\t\t<view class=\"upload-btn\" v-if=\"form.images.length < 9\" @click=\"chooseImage\">\n\t\t\t\t\t\t<text class=\"upload-icon\">+</text>\n\t\t\t\t\t\t<text>添加图片</text>\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t\t\n\t\t\t<view class=\"form-item\">\n\t\t\t\t<text class=\"label\">售价</text>\n\t\t\t\t<view class=\"price-input\">\n\t\t\t\t\t<text class=\"currency\">¥</text>\n\t\t\t\t\t<input class=\"input\" type=\"digit\" v-model=\"form.price\" placeholder=\"0.00\" />\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t\t\n\t\t\t<view class=\"form-item\">\n\t\t\t\t<text class=\"label\">原价（选填）</text>\n\t\t\t\t<view class=\"price-input\">\n\t\t\t\t\t<text class=\"currency\">¥</text>\n\t\t\t\t\t<input class=\"input\" type=\"digit\" v-model=\"form.originalPrice\" placeholder=\"0.00\" />\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t\t\n\t\t\t<view class=\"form-item\">\n\t\t\t\t<text class=\"label\">成色</text>\n\t\t\t\t<picker \n\t\t\t\t\tmode=\"selector\" \n\t\t\t\t\t:range=\"conditionOptions\" \n\t\t\t\t\t:value=\"conditionIndex\"\n\t\t\t\t\t@change=\"onConditionChange\">\n\t\t\t\t\t<view class=\"picker\">\n\t\t\t\t\t\t<text :class=\"{ placeholder: !form.condition }\">\n\t\t\t\t\t\t\t{{ form.condition || '请选择成色' }}\n\t\t\t\t\t\t</text>\n\t\t\t\t\t\t<text class=\"picker-arrow\">›</text>\n\t\t\t\t\t</view>\n\t\t\t\t</picker>\n\t\t\t</view>\n\t\t\t\n\t\t\t<view class=\"form-item\">\n\t\t\t\t<text class=\"label\">所在地区</text>\n\t\t\t\t<input class=\"input\" v-model=\"form.location\" placeholder=\"请输入所在地区\" />\n\t\t\t</view>\n\t\t\t\n\t\t\t<view class=\"form-item\">\n\t\t\t\t<text class=\"label\">商品描述</text>\n\t\t\t\t<textarea class=\"textarea\" v-model=\"form.description\" placeholder=\"请详细描述商品信息...\" maxlength=\"500\"></textarea>\n\t\t\t\t<text class=\"char-count\">{{ (form.description || '').length }}/500</text>\n\t\t\t</view>\n\t\t\t\n\t\t\t<button class=\"submit-btn\" @click=\"handleSubmit\">发布商品</button>\n\t\t</view>\n\t</view>\n</template>\n\n<script setup>\nimport { ref } from 'vue'\nimport { onLoad } from '@dcloudio/uni-app'\nimport { categoryApi, goodsApi } from '@/utils/apiService.js'\nimport { getCurrentUserId, checkLogin } from '@/utils/auth.js'\n\nconst categoryOptions = ref([])\nconst categoryIndex = ref(-1) // 当前选中的分类索引\nconst conditionOptions = ref(['全新', '99新', '95新', '9成新', '8成新', '7成新', '6成新以下'])\nconst conditionIndex = ref(-1) // 当前选中的成色索引\n\nconst form = ref({\n\ttitle: '',\n\tcategoryId: null,\n\tcategoryName: '',\n\timages: [],\n\tprice: '',\n\toriginalPrice: '',\n\tcondition: '',\n\tlocation: '',\n\tdescription: ''\n})\n\n// 加载分类列表\nasync function loadCategories() {\n\ttry {\n\t\tconst categories = await categoryApi.getCategoryList()\n\t\t// 获取所有主分类和子分类，展平为一个列表\n\t\tconst allCategories = []\n\t\t\n\t\tif (Array.isArray(categories)) {\n\t\t\tcategories.forEach(category => {\n\t\t\t\t// 添加主分类\n\t\t\t\tallCategories.push({\n\t\t\t\t\tid: category.id,\n\t\t\t\t\tname: category.name\n\t\t\t\t})\n\t\t\t\t\n\t\t\t\t// 如果有子分类，也添加进去\n\t\t\t\tif (category.children && Array.isArray(category.children)) {\n\t\t\t\t\tcategory.children.forEach(subCategory => {\n\t\t\t\t\t\tallCategories.push({\n\t\t\t\t\t\t\tid: subCategory.id,\n\t\t\t\t\t\t\tname: `${category.name} - ${subCategory.name}`\n\t\t\t\t\t\t})\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t\t\n\t\tcategoryOptions.value = allCategories\n\t} catch (error) {\n\t\tconsole.error('加载分类失败:', error)\n\t\tuni.showToast({ title: '加载分类失败', icon: 'none' })\n\t}\n}\n\n// 分类选择变化\nfunction onCategoryChange(e) {\n\tconst index = e.detail.value\n\tcategoryIndex.value = index\n\t\n\tif (categoryOptions.value[index]) {\n\t\tconst selectedCategory = categoryOptions.value[index]\n\t\tform.value.categoryId = selectedCategory.id\n\t\tform.value.categoryName = selectedCategory.name\n\t}\n}\n\n// 成色选择变化\nfunction onConditionChange(e) {\n\tconst index = e.detail.value\n\tconditionIndex.value = index\n\t\n\tif (conditionOptions.value[index]) {\n\t\tform.value.condition = conditionOptions.value[index]\n\t}\n}\n\n// 选择图片\nfunction chooseImage() {\n\tuni.chooseImage({\n\t\tcount: 9 - form.value.images.length,\n\t\tsuccess: (res) => {\n\t\t\tform.value.images = [...form.value.images, ...res.tempFilePaths]\n\t\t}\n\t})\n}\n\n// 删除图片\nfunction deleteImage(index) {\n\tform.value.images.splice(index, 1)\n}\n\n// 提交表单\nasync function handleSubmit() {\n\t// 表单验证\n\tif (!form.value.title) {\n\t\tuni.showToast({ title: '请输入商品标题', icon: 'none' })\n\t\treturn\n\t}\n\t\n\tif (!form.value.categoryId) {\n\t\tuni.showToast({ title: '请选择商品分类', icon: 'none' })\n\t\treturn\n\t}\n\t\n\tif (!form.value.images || form.value.images.length === 0) {\n\t\tuni.showToast({ title: '请至少上传一张图片', icon: 'none' })\n\t\treturn\n\t}\n\t\n\tif (!form.value.price) {\n\t\tuni.showToast({ title: '请输入售价', icon: 'none' })\n\t\treturn\n\t}\n\t\n\tif (!form.value.condition) {\n\t\tuni.showToast({ title: '请选择成色', icon: 'none' })\n\t\treturn\n\t}\n\t\n\tif (!form.value.location) {\n\t\tuni.showToast({ title: '请输入所在地区', icon: 'none' })\n\t\treturn\n\t}\n\t\n\t// 检查登录状态\n\tif (!checkLogin()) {\n\t\treturn\n\t}\n\t\n\tconst userId = getCurrentUserId()\n\tif (!userId) {\n\t\tuni.showToast({ title: '获取用户信息失败', icon: 'none' })\n\t\treturn\n\t}\n\t\n\ttry {\n\t\t// 准备提交数据\n\t\tconst submitData = {\n\t\t\ttitle: form.value.title,\n\t\t\tcategoryId: form.value.categoryId,\n\t\t\tcategoryName: form.value.categoryName,\n\t\t\timages: JSON.stringify(form.value.images), // 转换为JSON字符串\n\t\t\tprice: parseFloat(form.value.price),\n\t\t\toriginalPrice: form.value.originalPrice ? parseFloat(form.value.originalPrice) : null,\n\t\t\tcondition: form.value.condition,\n\t\t\tlocation: form.value.location,\n\t\t\tdescription: form.value.description || '',\n\t\t\tsellerId: userId\n\t\t}\n\t\t\n\t\t// 调用API发布商品\n\t\tawait goodsApi.createGoods(submitData)\n\t\t\n\t\tuni.showToast({ title: '发布成功', icon: 'success' })\n\t\t\n\t\t// 延迟跳转\n\t\tsetTimeout(() => {\n\t\t\tuni.navigateBack()\n\t\t}, 1500)\n\t} catch (error) {\n\t\tconsole.error('发布商品失败:', error)\n\t\tuni.showToast({ \n\t\t\ttitle: error.message || '发布失败', \n\t\t\ticon: 'none',\n\t\t\tduration: 2000\n\t\t})\n\t}\n}\n\nonLoad(() => {\n\tloadCategories()\n})\n</script>\n\n<style scoped>\n.container {\n\tmin-height: 100vh;\n\tbackground-color: transparent;\n\tpadding: 20rpx;\n}\n\n.form {\n\tbackground-color: #fff;\n\tborder-radius: 10rpx;\n\tpadding: 30rpx;\n}\n\n.form-item {\n\tmargin-bottom: 40rpx;\n}\n\n.label {\n\tfont-size: 28rpx;\n\tcolor: #333;\n\tfont-weight: bold;\n\tmargin-bottom: 20rpx;\n\tdisplay: block;\n}\n\n.input {\n\twidth: 100%;\n\theight: 80rpx;\n\tbackground-color: #F5F5F5;\n\tborder-radius: 10rpx;\n\tpadding-left:  20rpx;\n\tfont-size: 28rpx;\n}\n\n.picker {\n\tdisplay: flex;\n\tjustify-content: space-between;\n\talign-items: center;\n\theight: 80rpx;\n\tbackground-color: #F5F5F5;\n\tborder-radius: 10rpx;\n\tpadding: 0 20rpx;\n}\n\n.picker text.placeholder {\n\tcolor: #999;\n}\n\n.picker-arrow {\n\tfont-size: 32rpx;\n\tcolor: #999;\n}\n\n.upload-images {\n\tdisplay: flex;\n\tflex-wrap: wrap;\n\tgap: 20rpx;\n}\n\n.image-item {\n\tposition: relative;\n\twidth: 200rpx;\n\theight: 200rpx;\n\tborder-radius: 10rpx;\n\toverflow: hidden;\n}\n\n.image-item image {\n\twidth: 100%;\n\theight: 100%;\n}\n\n.delete-btn {\n\tposition: absolute;\n\ttop: 0;\n\tright: 0;\n\twidth: 40rpx;\n\theight: 40rpx;\n\tbackground-color: rgba(0, 0, 0, 0.6);\n\tcolor: #fff;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\tfont-size: 32rpx;\n\tborder-radius: 0 0 0 10rpx;\n}\n\n.upload-btn {\n\twidth: 200rpx;\n\theight: 200rpx;\n\tborder: 2rpx dashed #ddd;\n\tborder-radius: 10rpx;\n\tdisplay: flex;\n\tflex-direction: column;\n\talign-items: center;\n\tjustify-content: center;\n\tcolor: #999;\n\tfont-size: 24rpx;\n}\n\n.upload-icon {\n\tfont-size: 40rpx;\n\tmargin-bottom: 10rpx;\n}\n\n.price-input {\n\tdisplay: flex;\n\talign-items: center;\n\tbackground-color: #F5F5F5;\n\tborder-radius: 10rpx;\n\tpadding: 0 20rpx;\n}\n\n.currency {\n\tfont-size: 28rpx;\n\tcolor: #333;\n\tmargin-right: 10rpx;\n}\n\n.textarea {\n\twidth: 100%;\n\tmin-height: 200rpx;\n\tbackground-color: #F5F5F5;\n\tborder-radius: 10rpx;\n\tpadding-left: 20rpx;\n\tfont-size: 28rpx;\n}\n\n.char-count {\n\tfont-size: 24rpx;\n\tcolor: #999;\n\ttext-align: right;\n\tmargin-top: 10rpx;\n\tdisplay: block;\n}\n\n.submit-btn {\n\twidth: 100%;\n\theight: 88rpx;\n\tbackground-color: #007AFF;\n\tcolor: #fff;\n\tborder-radius: 50rpx;\n\tfont-size: 32rpx;\n\tmargin-top: 40rpx;\n\tborder: none;\n}\n</style>\n\n\n\n\n\n","import MiniProgramPage from 'G:/小程序xycy页面/SkyMark/pages/goods/publish.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","categoryApi","uni","checkLogin","getCurrentUserId","goodsApi","onLoad"],"mappings":"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"}