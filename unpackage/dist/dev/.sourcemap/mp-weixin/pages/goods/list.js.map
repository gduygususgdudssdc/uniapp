{"version":3,"file":"list.js","sources":["pages/goods/list.vue","../../hbuildx/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvZ29vZHMvbGlzdC52dWU"],"sourcesContent":["<template>\n\t<view class=\"container\">\n\t\t<!-- Á≠õÈÄâÊ†è -->\n\t\t<view class=\"filter-bar\">\n\t\t\t<view class=\"filter-item\" @click=\"showSort = !showSort\">\n\t\t\t\t<text>{{ sortText }}</text>\n\t\t\t\t<text class=\"arrow-icon\">‚Üì</text>\n\t\t\t</view>\n\t\t\t<view class=\"filter-item\" @click=\"showCategory = !showCategory\">\n\t\t\t\t<text>{{ categoryName || 'ÂÖ®ÈÉ®ÂàÜÁ±ª' }}</text>\n\t\t\t\t<text class=\"arrow-icon\">‚Üì</text>\n\t\t\t</view>\n\t\t</view>\n\t\t\n\t\t<!-- ÂïÜÂìÅÂàóË°® -->\n\t\t<view class=\"goods-list\">\n\t\t\t<view class=\"goods-item\" v-for=\"item in goodsList\" :key=\"item.id\">\n\t\t\t\t<image class=\"goods-image\" :src=\"item.images && item.images[0] ? item.images[0] : '/static/default-goods.png'\" mode=\"aspectFill\" @click=\"goToDetail(item.id)\"></image>\n\t\t\t\t<view class=\"goods-info\">\n\t\t\t\t\t<text class=\"goods-title\" @click=\"goToDetail(item.id)\">{{ item.title }}</text>\n\t\t\t\t\t<text class=\"goods-desc\" @click=\"goToDetail(item.id)\">{{ item.description }}</text>\n\t\t\t\t\t\n\t\t\t\t\t<!-- ÂçñÂÆ∂‰ø°ÊÅØ -->\n\t\t\t\t\t<view class=\"seller-info\" v-if=\"item.seller\" @click.stop=\"goToChat(item.seller.id)\">\n\t\t\t\t\t\t<image class=\"seller-avatar\" :src=\"item.seller.avatar || '/static/default-avatar.png'\" mode=\"aspectFill\"></image>\n\t\t\t\t\t\t<text class=\"seller-name\">{{ item.seller.username || 'ÂçñÂÆ∂' }}</text>\n\t\t\t\t\t\t<text class=\"chat-icon\">üí¨</text>\n\t\t\t\t\t</view>\n\t\t\t\t\t\n\t\t\t\t\t<view class=\"goods-footer\">\n\t\t\t\t\t\t<text class=\"goods-price\">¬•{{ item.price }}</text>\n\t\t\t\t\t\t<view class=\"goods-meta\">\n\t\t\t\t\t\t\t<text class=\"goods-location\">{{ item.location }}</text>\n\t\t\t\t\t\t\t<text class=\"goods-time\">{{ formatTime(item.createTime) }}</text>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t</view>\n\t\t\n\t\t<!-- Á©∫Áä∂ÊÄÅ -->\n\t\t<view v-if=\"goodsList.length === 0\" class=\"empty\">\n\t\t\t<text>ÊöÇÊó†ÂïÜÂìÅ</text>\n\t\t</view>\n\t\t\n\t\t<!-- ÊéíÂ∫èÂºπÁ™ó -->\n\t\t<view v-if=\"showSort\" class=\"popup\" @click=\"showSort = false\">\n\t\t\t<view class=\"popup-content\" @click.stop>\n\t\t\t\t<view class=\"popup-item\" v-for=\"item in sortOptions\" :key=\"item.value\"\n\t\t\t\t\t:class=\"{ active: currentSort === item.value }\" @click=\"selectSort(item.value)\">\n\t\t\t\t\t<text>{{ item.label }}</text>\n\t\t\t\t\t<text v-if=\"currentSort === item.value\" class=\"checkmark-icon\">‚úì</text>\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t</view>\n\t</view>\n</template>\n\n<script setup>\nimport { ref, computed } from 'vue'\nimport { onLoad } from '@dcloudio/uni-app'\nimport { goodsApi, categoryApi, userApi } from '@/utils/apiService.js'\nimport { getCurrentUserId, checkLogin } from '@/utils/auth.js'\n\nconst categoryId = ref('')\nconst categoryName = ref('')\nconst currentSort = ref('')\nconst showSort = ref(false)\nconst showCategory = ref(false)\nconst goodsList = ref([])\nconst sortOptions = ref([\n\t{ label: 'ÁªºÂêàÊéíÂ∫è', value: '' },\n\t{ label: '‰ª∑Ê†º‰ªé‰ΩéÂà∞È´ò', value: 'price_asc' },\n\t{ label: '‰ª∑Ê†º‰ªéÈ´òÂà∞‰Ωé', value: 'price_desc' },\n\t{ label: 'ÊúÄÊñ∞ÂèëÂ∏É', value: 'time_desc' }\n])\n\nconst sortText = computed(() => {\n\tconst option = sortOptions.value.find(item => item.value === currentSort.value)\n\treturn option ? option.label : 'ÁªºÂêàÊéíÂ∫è'\n})\n\nasync function loadGoods() {\n\ttry {\n\t\tconst params = {\n\t\t\tstatus: 'onSale',\n\t\t\tpage: 0,\n\t\t\tsize: 20\n\t\t}\n\t\tif (categoryId.value) {\n\t\t\tparams.categoryId = categoryId.value\n\t\t}\n\t\t\n\t\tconst result = await goodsApi.getGoodsList(params)\n\t\tlet list = result.content || result || []\n\t\t\n\t\t// Â§ÑÁêÜÊéíÂ∫è\n\t\tif (currentSort.value === 'price_asc') {\n\t\t\tlist.sort((a, b) => a.price - b.price)\n\t\t} else if (currentSort.value === 'price_desc') {\n\t\t\tlist.sort((a, b) => b.price - a.price)\n\t\t} else if (currentSort.value === 'time_desc') {\n\t\t\tlist.sort((a, b) => new Date(b.createTime) - new Date(a.createTime))\n\t\t}\n\t\t\n\t\t// Â§ÑÁêÜÂõæÁâáÊï∞ÊçÆÂíåÂçñÂÆ∂‰ø°ÊÅØ\n\t\tfor (let item of list) {\n\t\t\t// Â§ÑÁêÜÂõæÁâá\n\t\t\tif (typeof item.images === 'string') {\n\t\t\t\ttry {\n\t\t\t\t\titem.images = JSON.parse(item.images)\n\t\t\t\t} catch (e) {\n\t\t\t\t\titem.images = [item.images]\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (!Array.isArray(item.images)) {\n\t\t\t\titem.images = []\n\t\t\t}\n\t\t\t\n\t\t\t// Âä†ËΩΩÂçñÂÆ∂‰ø°ÊÅØ\n\t\t\tif (item.sellerId && !item.seller) {\n\t\t\t\ttry {\n\t\t\t\t\tconst seller = await userApi.getUserInfo(item.sellerId)\n\t\t\t\t\tif (seller) {\n\t\t\t\t\t\titem.seller = seller\n\t\t\t\t\t}\n\t\t\t\t} catch (error) {\n\t\t\t\t\tconsole.error('Âä†ËΩΩÂçñÂÆ∂‰ø°ÊÅØÂ§±Ë¥•:', error)\n\t\t\t\t\t// Â¶ÇÊûúÂä†ËΩΩÂ§±Ë¥•Ôºå‰ΩøÁî®ÈªòËÆ§ÂÄº\n\t\t\t\t\titem.seller = {\n\t\t\t\t\t\tid: item.sellerId,\n\t\t\t\t\t\tusername: 'ÂçñÂÆ∂',\n\t\t\t\t\t\tavatar: '/static/default-avatar.png'\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n\t\tgoodsList.value = list\n\t} catch (error) {\n\t\tconsole.error('Âä†ËΩΩÂïÜÂìÅÂ§±Ë¥•:', error)\n\t\tuni.showToast({ title: 'Âä†ËΩΩÂïÜÂìÅÂ§±Ë¥•', icon: 'none' })\n\t\tgoodsList.value = []\n\t}\n}\n\nfunction selectSort(value) {\n\tcurrentSort.value = value\n\tshowSort.value = false\n\tloadGoods()\n}\n\nfunction goToDetail(id) {\n\tuni.navigateTo({ url: `/pages/goods/detail?id=${id}` })\n}\n\n// Ë∑≥ËΩ¨Âà∞ËÅäÂ§©È°µÈù¢\nfunction goToChat(sellerId) {\n\tif (!checkLogin()) {\n\t\treturn\n\t}\n\t\n\tif (!sellerId) {\n\t\tuni.showToast({ title: 'ÂçñÂÆ∂‰ø°ÊÅØ‰∏çÂ≠òÂú®', icon: 'none' })\n\t\treturn\n\t}\n\t\n\tuni.navigateTo({ \n\t\turl: `/pages/message/chat?userId=${sellerId}` \n\t})\n}\n\nfunction formatTime(time) {\n\tconst date = new Date(time)\n\tconst now = new Date()\n\tconst diff = now - date\n\tconst days = Math.floor(diff / (1000 * 60 * 60 * 24))\n\tif (days === 0) {\n\t\tconst hours = Math.floor(diff / (1000 * 60 * 60))\n\t\tif (hours === 0) {\n\t\t\tconst minutes = Math.floor(diff / (1000 * 60))\n\t\t\treturn minutes + 'ÂàÜÈíüÂâç'\n\t\t}\n\t\treturn hours + 'Â∞èÊó∂Ââç'\n\t}\n\treturn days + 'Â§©Ââç'\n}\n\nonLoad(async (options) => {\n\tif (options && options.categoryId) {\n\t\tcategoryId.value = options.categoryId\n\t\ttry {\n\t\t\tconst category = await categoryApi.getCategoryDetail(categoryId.value)\n\t\t\tif (category) {\n\t\t\t\tcategoryName.value = category.name\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tconsole.error('Âä†ËΩΩÂàÜÁ±ª‰ø°ÊÅØÂ§±Ë¥•:', error)\n\t\t}\n\t}\n\tawait loadGoods()\n})\n</script>\n\n<style scoped>\n.container {\n\tmin-height: 100vh;\n\tbackground-color: #F5F5F5;\n}\n\n.filter-bar {\n\tdisplay: flex;\n\tbackground-color: #fff;\n\tpadding: 20rpx;\n\tborder-bottom: 1rpx solid #eee;\n}\n\n.filter-item {\n\tdisplay: flex;\n\talign-items: center;\n\tmargin-right: 40rpx;\n\tfont-size: 28rpx;\n\tcolor: #666;\n}\n\n.arrow-icon {\n\tfont-size: 20rpx;\n\tmargin-left: 10rpx;\n\tcolor: #666;\n}\n\n.checkmark-icon {\n\tfont-size: 24rpx;\n\tcolor: #007AFF;\n\tfont-weight: bold;\n}\n\n.goods-list {\n\tpadding: 20rpx;\n}\n\n.goods-item {\n\tdisplay: flex;\n\tbackground-color: #fff;\n\tborder-radius: 10rpx;\n\tpadding: 20rpx;\n\tmargin-bottom: 20rpx;\n}\n\n.goods-image {\n\twidth: 200rpx;\n\theight: 200rpx;\n\tborder-radius: 10rpx;\n\tmargin-right: 20rpx;\n}\n\n.goods-info {\n\tflex: 1;\n\tdisplay: flex;\n\tflex-direction: column;\n\tjustify-content: space-between;\n}\n\n.goods-title {\n\tfont-size: 28rpx;\n\tcolor: #333;\n\tfont-weight: bold;\n\tmargin-bottom: 10rpx;\n}\n\n.goods-desc {\n\tfont-size: 24rpx;\n\tcolor: #999;\n\tdisplay: -webkit-box;\n\t-webkit-box-orient: vertical;\n\t-webkit-line-clamp: 2;\n\toverflow: hidden;\n\tmargin-bottom: 10rpx;\n}\n\n.goods-footer {\n\tdisplay: flex;\n\tjustify-content: space-between;\n\talign-items: center;\n}\n\n.goods-price {\n\tfont-size: 32rpx;\n\tcolor: #FF5722;\n\tfont-weight: bold;\n}\n\n.goods-meta {\n\tdisplay: flex;\n\tflex-direction: column;\n\talign-items: flex-end;\n}\n\n.goods-location {\n\tfont-size: 22rpx;\n\tcolor: #999;\n\tmargin-bottom: 5rpx;\n}\n\n.goods-time {\n\tfont-size: 22rpx;\n\tcolor: #999;\n}\n\n.seller-info {\n\tdisplay: flex;\n\talign-items: center;\n\tmargin: 10rpx 0;\n\tpadding: 10rpx;\n\tbackground-color: #F5F5F5;\n\tborder-radius: 8rpx;\n}\n\n.seller-avatar {\n\twidth: 40rpx;\n\theight: 40rpx;\n\tborder-radius: 50%;\n\tmargin-right: 10rpx;\n}\n\n.seller-name {\n\tflex: 1;\n\tfont-size: 22rpx;\n\tcolor: #666;\n}\n\n.chat-icon {\n\tfont-size: 24rpx;\n\tmargin-left: 10rpx;\n}\n\n.empty {\n\tdisplay: flex;\n\tjustify-content: center;\n\talign-items: center;\n\tpadding: 100rpx 0;\n\tcolor: #999;\n}\n\n.popup {\n\tposition: fixed;\n\ttop: 0;\n\tleft: 0;\n\tright: 0;\n\tbottom: 0;\n\tbackground-color: rgba(0, 0, 0, 0.5);\n\tz-index: 999;\n}\n\n.popup-content {\n\tbackground-color: #fff;\n\tmargin-top: 88rpx;\n}\n\n.popup-item {\n\tdisplay: flex;\n\tjustify-content: space-between;\n\talign-items: center;\n\tpadding: 30rpx;\n\tborder-bottom: 1rpx solid #eee;\n}\n\n.popup-item.active {\n\tcolor: #007AFF;\n}\n</style>\n\n","import MiniProgramPage from 'G:/Â∞èÁ®ãÂ∫èxycyÈ°µÈù¢/SkyMark/pages/goods/list.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","computed","goodsApi","userApi","uni","checkLogin","onLoad","categoryApi"],"mappings":"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"}