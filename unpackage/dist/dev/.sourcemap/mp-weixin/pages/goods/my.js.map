{"version":3,"file":"my.js","sources":["pages/goods/my.vue","../../hbuildx/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvZ29vZHMvbXkudnVl"],"sourcesContent":["<template>\n\t<view class=\"container\">\n\t\t<!-- 标签页 -->\n\t\t<view class=\"tabs\">\n\t\t\t<view \n\t\t\t\tclass=\"tab-item\" \n\t\t\t\t:class=\"{ active: currentTab === item.value }\"\n\t\t\t\tv-for=\"item in tabs\" \n\t\t\t\t:key=\"item.value\"\n\t\t\t\t@click=\"switchTab(item.value)\"\n\t\t\t>\n\t\t\t\t<text>{{ item.label }}</text>\n\t\t\t</view>\n\t\t</view>\n\t\t\n\t\t<!-- 商品列表 -->\n\t\t<view class=\"goods-list\">\n\t\t\t<view \n\t\t\t\tclass=\"goods-item\" \n\t\t\t\tv-for=\"item in filterGoods\" \n\t\t\t\t:key=\"item.id\"\n\t\t\t>\n\t\t\t\t<image \n\t\t\t\t\tclass=\"goods-image\" \n\t\t\t\t\t:src=\"item.images && item.images[0] ? item.images[0] : '/static/default-goods.png'\" \n\t\t\t\t\tmode=\"aspectFill\"\n\t\t\t\t\t@click=\"goToDetail(item.id)\"\n\t\t\t\t></image>\n\t\t\t\t<view class=\"goods-info\">\n\t\t\t\t\t<text class=\"goods-title\" @click=\"goToDetail(item.id)\">{{ item.title }}</text>\n\t\t\t\t\t<view class=\"goods-meta\">\n\t\t\t\t\t\t<text class=\"goods-price\">¥{{ item.price }}</text>\n\t\t\t\t\t\t<text class=\"goods-status\" :class=\"item.status\">{{ getStatusText(item.status) }}</text>\n\t\t\t\t\t</view>\n\t\t\t\t\t<view class=\"goods-actions\">\n\t\t\t\t\t\t<button class=\"action-btn\" @click=\"editGoods(item.id)\">编辑</button>\n\t\t\t\t\t\t<button class=\"action-btn danger\" @click=\"deleteGoods(item.id)\">删除</button>\n\t\t\t\t\t\t<button v-if=\"item.status === 'onSale'\" class=\"action-btn\" @click=\"offShelf(item.id)\">下架</button>\n\t\t\t\t\t\t<button v-if=\"item.status === 'offShelf'\" class=\"action-btn\" @click=\"onShelf(item.id)\">上架</button>\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t</view>\n\t\t\n\t\t<!-- 空状态 -->\n\t\t<view v-if=\"filterGoods.length === 0 && !loading\" class=\"empty\">\n\t\t\t<text>暂无商品</text>\n\t\t</view>\n\t\t\n\t\t<!-- 加载状态 -->\n\t\t<view v-if=\"loading\" class=\"loading\">\n\t\t\t<text>加载中...</text>\n\t\t</view>\n\t</view>\n</template>\n\n<script setup>\nimport { ref, computed } from 'vue'\nimport { onLoad, onShow } from '@dcloudio/uni-app'\nimport { goodsApi } from '@/utils/apiService.js'\nimport { checkLogin, getCurrentUserId } from '@/utils/auth.js'\n\nconst goodsList = ref([])\nconst currentTab = ref('onSale')\nconst loading = ref(false)\n\nconst tabs = ref([\n\t{ label: '在售', value: 'onSale' },\n\t{ label: '已下架', value: 'offShelf' },\n\t{ label: '已售出', value: 'sold' }\n])\n\nconst filterGoods = computed(() => {\n\treturn goodsList.value.filter(item => item.status === currentTab.value)\n})\n\nasync function loadGoods() {\n\tif (!checkLogin()) {\n\t\treturn\n\t}\n\t\n\tconst userId = getCurrentUserId()\n\tif (!userId) {\n\t\tuni.showToast({ title: '获取用户信息失败', icon: 'none' })\n\t\treturn\n\t}\n\t\n\tloading.value = true\n\ttry {\n\t\tconst goods = await goodsApi.getMyGoods(userId)\n\t\tif (Array.isArray(goods)) {\n\t\t\tgoods.forEach(item => {\n\t\t\t\t// 处理图片数据\n\t\t\t\tif (item.images && typeof item.images === 'string') {\n\t\t\t\t\ttry {\n\t\t\t\t\t\titem.images = JSON.parse(item.images)\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\titem.images = [item.images]\n\t\t\t\t\t}\n\t\t\t\t} else if (!Array.isArray(item.images)) {\n\t\t\t\t\titem.images = []\n\t\t\t\t}\n\t\t\t})\n\t\t\tgoodsList.value = goods\n\t\t} else {\n\t\t\tgoodsList.value = []\n\t\t}\n\t} catch (error) {\n\t\tconsole.error('加载商品失败:', error)\n\t\tuni.showToast({\n\t\t\ttitle: error.message || '加载商品失败',\n\t\t\ticon: 'none',\n\t\t\tduration: 2000\n\t\t})\n\t\tgoodsList.value = []\n\t} finally {\n\t\tloading.value = false\n\t}\n}\n\nfunction switchTab(value) {\n\tcurrentTab.value = value\n}\n\nfunction getStatusText(status) {\n\tconst statusMap = {\n\t\t'onSale': '在售',\n\t\t'offShelf': '已下架',\n\t\t'sold': '已售出'\n\t}\n\treturn statusMap[status] || status\n}\n\nfunction goToDetail(id) {\n\tuni.navigateTo({\n\t\turl: `/pages/goods/detail?id=${id}`\n\t})\n}\n\nfunction editGoods(id) {\n\tuni.navigateTo({\n\t\turl: `/pages/goods/edit?id=${id}`\n\t})\n}\n\nasync function deleteGoods(id) {\n\tuni.showModal({\n\t\ttitle: '提示',\n\t\tcontent: '确定要删除这个商品吗？',\n\t\tsuccess: async (res) => {\n\t\t\tif (res.confirm) {\n\t\t\t\ttry {\n\t\t\t\t\tawait goodsApi.deleteGoods(id)\n\t\t\t\t\tuni.showToast({ title: '删除成功', icon: 'success' })\n\t\t\t\t\tloadGoods()\n\t\t\t\t} catch (error) {\n\t\t\t\t\tconsole.error('删除商品失败:', error)\n\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\ttitle: error.message || '删除失败',\n\t\t\t\t\t\ticon: 'none'\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t})\n}\n\nfunction prepareGoodsForUpdate(goods) {\n\tconst updateData = { ...goods }\n\tif (Array.isArray(updateData.images)) {\n\t\tupdateData.images = JSON.stringify(updateData.images)\n\t}\n\tdelete updateData.createTime\n\treturn updateData\n}\n\nasync function offShelf(id) {\n\ttry {\n\t\tconst goods = goodsList.value.find(item => item.id === id)\n\t\tif (!goods) return\n\t\t\n\t\tconst updateData = prepareGoodsForUpdate(goods)\n\t\tupdateData.status = 'offShelf'\n\t\tawait goodsApi.updateGoods(id, updateData)\n\t\tuni.showToast({ title: '已下架', icon: 'success' })\n\t\tloadGoods()\n\t} catch (error) {\n\t\tconsole.error('下架商品失败:', error)\n\t\tuni.showToast({\n\t\t\ttitle: error.message || '下架失败',\n\t\t\ticon: 'none'\n\t\t})\n\t}\n}\n\nasync function onShelf(id) {\n\ttry {\n\t\tconst goods = goodsList.value.find(item => item.id === id)\n\t\tif (!goods) return\n\t\t\n\t\tconst updateData = prepareGoodsForUpdate(goods)\n\t\tupdateData.status = 'onSale'\n\t\tawait goodsApi.updateGoods(id, updateData)\n\t\tuni.showToast({ title: '已上架', icon: 'success' })\n\t\tloadGoods()\n\t} catch (error) {\n\t\tconsole.error('上架商品失败:', error)\n\t\tuni.showToast({\n\t\t\ttitle: error.message || '上架失败',\n\t\t\ticon: 'none'\n\t\t})\n\t}\n}\n\nonLoad(() => {\n\tloadGoods()\n})\n\nonShow(() => {\n\tif (checkLogin()) {\n\t\tloadGoods()\n\t}\n})\n</script>\n\n<style scoped>\n.container {\n\tmin-height: 100vh;\n\tbackground-color: #F5F5F5;\n}\n\n.tabs {\n\tdisplay: flex;\n\tbackground-color: #fff;\n\tpadding: 0 20rpx;\n\tborder-bottom: 1rpx solid #eee;\n}\n\n.tab-item {\n\tflex: 1;\n\ttext-align: center;\n\tpadding: 30rpx 0;\n\tfont-size: 28rpx;\n\tcolor: #666;\n\tposition: relative;\n}\n\n.tab-item.active {\n\tcolor: #007AFF;\n\tfont-weight: bold;\n}\n\n.tab-item.active::after {\n\tcontent: '';\n\tposition: absolute;\n\tbottom: 0;\n\tleft: 50%;\n\ttransform: translateX(-50%);\n\twidth: 60rpx;\n\theight: 4rpx;\n\tbackground-color: #007AFF;\n}\n\n.goods-list {\n\tpadding: 20rpx;\n}\n\n.goods-item {\n\tdisplay: flex;\n\tbackground-color: #fff;\n\tborder-radius: 10rpx;\n\tpadding: 20rpx;\n\tmargin-bottom: 20rpx;\n}\n\n.goods-image {\n\twidth: 200rpx;\n\theight: 200rpx;\n\tborder-radius: 10rpx;\n\tmargin-right: 20rpx;\n\tflex-shrink: 0;\n}\n\n.goods-info {\n\tflex: 1;\n\tdisplay: flex;\n\tflex-direction: column;\n\tjustify-content: space-between;\n}\n\n.goods-title {\n\tfont-size: 28rpx;\n\tcolor: #333;\n\tfont-weight: bold;\n\tmargin-bottom: 10rpx;\n\toverflow: hidden;\n\ttext-overflow: ellipsis;\n\tdisplay: -webkit-box;\n\t-webkit-line-clamp: 2;\n\t-webkit-box-orient: vertical;\n}\n\n.goods-meta {\n\tdisplay: flex;\n\tjustify-content: space-between;\n\talign-items: center;\n\tmargin-bottom: 20rpx;\n}\n\n.goods-price {\n\tfont-size: 32rpx;\n\tcolor: #FF5722;\n\tfont-weight: bold;\n}\n\n.goods-status {\n\tfont-size: 24rpx;\n\tpadding: 5rpx 15rpx;\n\tborder-radius: 5rpx;\n}\n\n.goods-status.onSale {\n\tbackground-color: #E3F2FD;\n\tcolor: #1976D2;\n}\n\n.goods-status.offShelf {\n\tbackground-color: #FFF3E0;\n\tcolor: #F57C00;\n}\n\n.goods-status.sold {\n\tbackground-color: #E8F5E9;\n\tcolor: #388E3C;\n}\n\n.goods-actions {\n\tdisplay: flex;\n\tgap: 20rpx;\n}\n\n.action-btn {\n\tflex: 1;\n\theight: 60rpx;\n\tline-height: 60rpx;\n\tbackground-color: #F5F5F5;\n\tcolor: #333;\n\tborder-radius: 30rpx;\n\tfont-size: 24rpx;\n\tborder: none;\n\tpadding: 0;\n\ttext-align: center;\n}\n\n.action-btn.danger {\n\tbackground-color: #FFEBEE;\n\tcolor: #D32F2F;\n}\n\n.empty {\n\tdisplay: flex;\n\tjustify-content: center;\n\talign-items: center;\n\tpadding: 100rpx 0;\n\tcolor: #999;\n\tfont-size: 28rpx;\n}\n\n.loading {\n\tdisplay: flex;\n\tjustify-content: center;\n\talign-items: center;\n\tpadding: 100rpx 0;\n\tcolor: #999;\n\tfont-size: 28rpx;\n}\n</style>\n","import MiniProgramPage from 'G:/小程序xycy页面/SkyMark/pages/goods/my.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","computed","checkLogin","getCurrentUserId","uni","goodsApi","onLoad","onShow"],"mappings":"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"}